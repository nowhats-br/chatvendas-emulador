var o=Object.defineProperty;var a=(s,e,t)=>e in s?o(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>a(s,typeof e!="symbol"?e+"":e,t);import{P as n}from"./ProductService-DJdeptBB.js";class c{constructor(){d(this,"orders",[]);this.loadInitialData()}loadInitialData(){const e=localStorage.getItem("chatvendas_orders");e?this.orders=JSON.parse(e):this.orders=[]}save(){localStorage.setItem("chatvendas_orders",JSON.stringify(this.orders)),window.dispatchEvent(new Event("order-update"))}getAll(){return[...this.orders].sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())}getById(e){return this.orders.find(t=>t.id===e)}async createOrder(e){return console.log("[OrderService] Processando nova venda..."),new Promise(t=>{setTimeout(()=>{e.items.forEach(i=>{n.decrementStock(i.id.toString(),i.qty)});const r={...e,id:`#${Math.floor(1e3+Math.random()*9e3)}`,status:e.payment.method==="pix"||e.payment.method==="cash"?"pending":"paid",updatedAt:new Date().toISOString(),customerName:e.customerName||"Cliente Visitante"};this.orders.unshift(r),this.save(),console.log("[Financeiro] Venda registrada:",r.id),t({success:!0,orderId:r.id})},1e3)})}updateStatus(e,t){const r=this.orders.find(i=>i.id===e);r&&(r.status=t,r.updatedAt=new Date().toISOString(),this.save())}assignDriver(e,t){const r=this.orders.find(i=>i.id===e);r&&(r.driverId=t,r.status="delivery",r.updatedAt=new Date().toISOString(),this.save())}}const m=new c;export{m as O};
