var p=Object.defineProperty;var w=(e,s,t)=>s in e?p(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var r=(e,s,t)=>w(e,typeof s!="symbol"?s+"":s,t);import{d as R,R as h}from"./index-CzIT3y9u.js";class l extends Error{constructor(t,o,i,c,n){super(t);r(this,"code");r(this,"status");r(this,"details");r(this,"timestamp");r(this,"context");this.name="AppError",this.code=o,this.status=i,this.details=c,this.timestamp=Date.now(),this.context=n}toJSON(){return{message:this.message,code:this.code,status:this.status,details:this.details,timestamp:this.timestamp,context:this.context}}}class E extends l{constructor(s,t,o){super(s,"NETWORK_ERROR",t,o,"Network")}}class x extends l{constructor(s,t){super(s,"VALIDATION_ERROR",400,t,"Validation")}}class y extends l{constructor(s,t){super(s,"AUTH_ERROR",401,t,"Authentication")}}class N extends l{constructor(s,t){super(s,"NOT_FOUND",404,t,"NotFound")}}class m extends l{constructor(s,t){super(s,"SERVER_ERROR",500,t,"Server")}}class O{constructor(){r(this,"logs",[]);r(this,"maxLogs",100)}log(s,t){const o={message:s.message,timestamp:Date.now(),context:t};s instanceof l&&(o.code=s.code,o.status=s.status,o.details=s.details,o.context=s.context||t),this.logs.unshift(o),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(0,this.maxLogs)),console.error("ðŸš¨ Error logged:",o)}getLogs(){return[...this.logs]}clearLogs(){this.logs=[]}getLogsByContext(s){return this.logs.filter(t=>t.context===s)}}const L=new O;function u(e,s){let t;return e instanceof l?t=e:e instanceof Error?e.message.includes("fetch")||e.message.includes("network")?t=new E(e.message):e.message.includes("validation")||e.message.includes("invalid")?t=new x(e.message):e.message.includes("unauthorized")||e.message.includes("forbidden")?t=new y(e.message):e.message.includes("not found")?t=new N(e.message):t=new m(e.message):t=new m("Erro desconhecido","UNKNOWN_ERROR",500,e),L.log(t,s),t}async function A(e,s={}){const{maxAttempts:t=3,delay:o=1e3,backoff:i="exponential",retryCondition:c=a=>a instanceof E}=s;let n;for(let a=1;a<=t;a++)try{return await e()}catch(d){if(n=d instanceof Error?d:new Error("Unknown error"),!c(n)||a===t)throw u(n,"Retry");const g=i==="exponential"?o*Math.pow(2,a-1):o*a;console.warn(`ðŸ”„ Retry attempt ${a}/${t} after ${g}ms`),await new Promise(f=>setTimeout(f,g))}throw u(n,"Retry")}function _(){const{error:e}=R(),s=h.useCallback((o,i,c=!0)=>{const n=u(o,i);return c&&e("Erro",n.message),n},[e]),t=h.useCallback(async(o,i,c)=>{try{return await A(o,i)}catch(n){throw s(n,c)}},[s]);return{handleError:s,executeWithRetry:t}}export{_ as u};
