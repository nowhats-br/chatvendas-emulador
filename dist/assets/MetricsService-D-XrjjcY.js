var a=Object.defineProperty;var h=(t,e,s)=>e in t?a(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var c=(t,e,s)=>h(t,typeof e!="symbol"?e+"":e,s);class g{constructor(){c(this,"metrics",new Map);c(this,"history",new Map);c(this,"maxHistorySize",100);c(this,"listeners",new Map)}increment(e,s=1,i){const r=this.getMetricKey(e,i),n=this.metrics.get(r),m={id:r,name:e,value:((n==null?void 0:n.value)||0)+s,timestamp:Date.now(),type:"counter",tags:i};this.metrics.set(r,m),this.addToHistory(r,m.value),this.notifyListeners(e,m)}gauge(e,s,i){const r=this.getMetricKey(e,i),n={id:r,name:e,value:s,timestamp:Date.now(),type:"gauge",tags:i};this.metrics.set(r,n),this.addToHistory(r,s),this.notifyListeners(e,n)}histogram(e,s,i){const r=this.getMetricKey(e,i),n={id:r,name:e,value:s,timestamp:Date.now(),type:"histogram",tags:i};this.metrics.set(r,n),this.addToHistory(r,s),this.notifyListeners(e,n)}get(e,s){const i=this.getMetricKey(e,s);return this.metrics.get(i)||null}getAll(){return Array.from(this.metrics.values())}getByPattern(e){return this.getAll().filter(s=>e.test(s.name))}getHistory(e,s){const i=this.getMetricKey(e,s);return this.history.get(i)||[]}subscribe(e,s){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(s),()=>{const i=this.listeners.get(e);if(i){const r=i.indexOf(s);r>-1&&i.splice(r,1)}}}clear(){this.metrics.clear(),this.history.clear()}getPerformanceMetrics(){const s=Date.now()-6e4,i=this.getAll().filter(r=>r.timestamp>s);return{totalMetrics:this.metrics.size,recentMetrics:i.length,memoryUsage:this.getMemoryUsage(),uptime:this.getUptime()}}getMetricKey(e,s){if(!s||Object.keys(s).length===0)return e;const i=Object.entries(s).sort(([r],[n])=>r.localeCompare(n)).map(([r,n])=>`${r}=${n}`).join(",");return`${e}{${i}}`}addToHistory(e,s){this.history.has(e)||this.history.set(e,[]);const i=this.history.get(e);i.push({timestamp:Date.now(),value:s}),i.length>this.maxHistorySize&&i.splice(0,i.length-this.maxHistorySize)}notifyListeners(e,s){const i=this.listeners.get(e);i&&i.forEach(r=>{try{r(s)}catch(n){console.error("Error in metric listener:",n)}})}getMemoryUsage(){return typeof window<"u"&&"performance"in window&&"memory"in window.performance?window.performance.memory.usedJSHeapSize:0}getUptime(){return typeof window<"u"&&"performance"in window?window.performance.now():0}}const o=new g,p={instanceConnected:t=>o.increment("instances.connected",1,{instanceId:t}),instanceDisconnected:t=>o.increment("instances.disconnected",1,{instanceId:t}),instanceError:(t,e)=>o.increment("instances.errors",1,{instanceId:t,error:e}),messageSent:t=>o.increment("messages.sent",1,{instanceId:t}),messageReceived:t=>o.increment("messages.received",1,{instanceId:t}),messageError:(t,e)=>o.increment("messages.errors",1,{instanceId:t,error:e}),apiResponseTime:(t,e)=>o.histogram("api.response_time",e,{endpoint:t}),componentRenderTime:(t,e)=>o.histogram("component.render_time",e,{component:t}),userAction:(t,e)=>o.increment("user.actions",1,{action:t,component:e}),pageView:t=>o.increment("user.page_views",1,{page:t}),activeConnections:t=>o.gauge("system.active_connections",t),memoryUsage:t=>o.gauge("system.memory_usage",t),cpuUsage:t=>o.gauge("system.cpu_usage",t)};export{p as M};
