var Qe=Object.defineProperty;var Re=(i,t,o)=>t in i?Qe(i,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[t]=o;var B=(i,t,o)=>Re(i,typeof t!="symbol"?t+"":t,o);import{c as Ue,j as e,a as U,D as ze,M as oe,U as Be,T as We,R as r,d as He,r as W,Z as le,C as ve,u as Je,p as we,g as Ge}from"./index-CzIT3y9u.js";import{C as H}from"./ContactService-DQXUB0x0.js";import{A as O}from"./AIConfigService-2_9wLCgs.js";import{A as ce}from"./Avatar-D4MzB8h-.js";import{S as Y}from"./sparkles-jCsqdd4H.js";import{C as je,X as Ye}from"./x-kyJA4pzP.js";import{T as Ze}from"./triangle-alert-BMYn3P-T.js";import{T as Xe}from"./TemplateService-C5x210Bu.js";import{T as Ke,P as Me}from"./trash-2-CSEduQTA.js";import{S as et}from"./save-DzOm7sR2.js";import{R as tt}from"./refresh-cw-BRXlEgGe.js";import"./OrderService-B3PyY6dO.js";import"./ProductService-DJdeptBB.js";import"./LogService-D1NsVqvs.js";import"./MetricsService-D-XrjjcY.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],ot=Ue("crown",st);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]],at=Ue("list-todo",nt);class lt{constructor(){B(this,"tasks",[]);B(this,"sequences",[]);B(this,"triggers",[]);B(this,"COOLDOWN_DAYS",7);B(this,"cooldownDays",7);try{this.loadInitialData(),this.setupDefaultSequences(),this.setupEventListeners()}catch(t){console.error("Erro ao inicializar FollowUpService:",t),this.tasks=[],this.sequences=[],this.triggers=[]}}async loadInitialData(){try{const t=localStorage.getItem("chatvendas_followups");if(t){this.tasks=JSON.parse(t);try{(await H.getAll()).length===0&&(console.log("ðŸ§¹ Limpando tarefas antigas - sistema sem contatos reais"),this.tasks=[],this.save())}catch(l){console.warn("Erro ao verificar contatos:",l)}}const o=localStorage.getItem("chatvendas_followup_sequences");o&&(this.sequences=JSON.parse(o));const s=localStorage.getItem("chatvendas_followup_triggers");s&&(this.triggers=JSON.parse(s))}catch(t){console.error("Erro ao carregar dados do FollowUp:",t),this.tasks=[],this.sequences=[],this.triggers=[]}}save(){localStorage.setItem("chatvendas_followups",JSON.stringify(this.tasks)),localStorage.setItem("chatvendas_followup_sequences",JSON.stringify(this.sequences)),localStorage.setItem("chatvendas_followup_triggers",JSON.stringify(this.triggers)),window.dispatchEvent(new Event("followup-update"))}generateId(){return`followup_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}addDays(t,o){const s=new Date(t);return s.setDate(s.getDate()+o),s}getFirstName(t){return t.split(" ")[0]}daysSince(t){const o=new Date(t),l=Math.abs(new Date().getTime()-o.getTime());return Math.ceil(l/(1e3*60*60*24))}hasRecentMessages(t,o=7){try{const s=new Date;s.setDate(s.getDate()-o);const l=this.tasks.filter(a=>a.contactId===t&&a.status==="completed"&&a.completedAt&&new Date(a.completedAt)>s),n=this.tasks.filter(a=>a.contactId===t&&a.status==="scheduled"&&new Date(a.dueDate)>new Date),d=l.length>0||n.length>0;return d&&console.log(`â­ï¸ Pulando ${t} - mensagens recentes ou agendadas (Ãºltimos ${o} dias)`),d}catch(s){return console.warn("Erro ao verificar mensagens recentes:",s),!1}}setupDefaultSequences(){this.sequences.length===0&&(this.sequences=[{id:"post_sale_sequence",name:"PÃ³s-venda Completa",description:"SequÃªncia automÃ¡tica apÃ³s finalizar venda",trigger:"sale_completed",steps:[{id:"step_1",delayDays:1,messageTemplate:"Oi {{nome}}! Seu pedido foi confirmado ðŸŽ‰ Em breve vocÃª receberÃ¡ o cÃ³digo de rastreamento!",type:"text",priority:"medium"},{id:"step_2",delayDays:7,messageTemplate:"OlÃ¡ {{nome}}! Como estÃ¡ seu pedido? Ficou satisfeito? Sua avaliaÃ§Ã£o Ã© muito importante! â­",type:"text",priority:"low"},{id:"step_3",delayDays:30,messageTemplate:"Oi {{nome}}! Que tal dar uma olhada nas novidades? Temos produtos incrÃ­veis para vocÃª! ðŸ›ï¸",type:"text",priority:"medium"}],active:!0},{id:"campaign_response_sequence",name:"Resposta de Campanha",description:"SequÃªncia quando cliente responde campanha mas nÃ£o compra",trigger:"campaign_response_no_sale",steps:[{id:"step_1",delayDays:2,messageTemplate:"Oi {{nome}}! Vi que vocÃª demonstrou interesse. Posso esclarecer alguma dÃºvida? ðŸ˜Š",type:"text",priority:"high"},{id:"step_2",delayDays:7,messageTemplate:"OlÃ¡ {{nome}}! Preparei uma oferta especial sÃ³ para vocÃª. Que tal conversarmos? ðŸ’Ž",type:"text",priority:"medium"}],active:!0},{id:"abandoned_cart_sequence",name:"Carrinho Abandonado",description:"RecuperaÃ§Ã£o de carrinho abandonado",trigger:"cart_abandoned",steps:[{id:"step_1",delayDays:1,messageTemplate:"Oi {{nome}}! VocÃª esqueceu alguns itens no seu carrinho. Que tal finalizar? ðŸ›’",type:"text",priority:"high"},{id:"step_2",delayDays:3,messageTemplate:"OlÃ¡ {{nome}}! Seus itens ainda estÃ£o reservados. Finalize agora com 10% OFF! ðŸŽ",type:"text",priority:"high"}],active:!0}],this.save())}setupEventListeners(){window.addEventListener("sale_completed",t=>{this.handleSaleCompleted(t.detail)}),window.addEventListener("campaign_response",t=>{this.handleCampaignResponse(t.detail)}),window.addEventListener("cart_abandoned",t=>{this.handleCartAbandoned(t.detail)}),window.addEventListener("message_received",t=>{this.handleMessageReceived(t.detail)})}handleSaleCompleted(t){console.log("ðŸŽ‰ Venda finalizada - Iniciando sequÃªncia pÃ³s-venda:",t),this.createAISequence("sale_completed",t.contactId,{orderId:t.orderId,orderValue:t.value})}async handleCampaignResponse(t){console.log("ðŸ“± Resposta de campanha - Verificando se houve venda:",t),setTimeout(async()=>{try{const s=(await H.getAll()).find(l=>l.id===t.contactId);s&&s.lastPurchaseDate&&(Date.now()-new Date(s.lastPurchaseDate).getTime())/36e5>24&&this.createAISequence("lead_cold",t.contactId,{campaignId:t.campaignId,responseMessageId:t.messageId})}catch(o){console.error("Erro ao verificar contato:",o)}},1440*60*1e3)}handleCartAbandoned(t){console.log("ðŸ›’ Carrinho abandonado - Iniciando recuperaÃ§Ã£o:",t),this.createAISequence("cart_abandoned",t.contactId,{cartId:t.cartId,items:t.items})}async createAISequence(t,o,s={}){try{const n=(await H.getAll()).find(c=>c.id===o);if(!n){console.warn("Contato nÃ£o encontrado para sequÃªncia IA:",o);return}const a=O.getSequences().find(c=>c.trigger===t&&c.active);if(!a){console.warn("SequÃªncia IA nÃ£o encontrada para trigger:",t);return}console.log(`ðŸ¤– Criando sequÃªncia IA "${a.name}" para ${n.name}`),this.cancelSequence(o,`ai_${t}`);const N={contactName:n.name,contactPhone:n.phoneNumber,contactTags:n.tags||[],ltv:n.ltv,lastPurchaseDate:n.lastPurchaseDate,lastPurchaseValue:n.lastPurchaseValue,lastPurchaseProducts:n.lastPurchaseProducts,kanbanStage:n.kanbanStage,daysSinceLastPurchase:n.lastPurchaseDate?this.daysSince(n.lastPurchaseDate):void 0,totalPurchases:n.totalPurchases,averageOrderValue:n.averageOrderValue,preferredProducts:n.preferredProducts,birthday:n.birthday,location:n.location,customFields:{...n.customFields,...s}};for(let c=0;c<a.templates.length;c++){const p=a.templates[c],x=a.delays[c]||0,D=this.addDays(new Date,x);try{const M=await O.generateSmartMessage(p.id,N),b={id:this.generateId(),contactId:n.id,contactName:n.name,contactPhone:n.phoneNumber,contactAvatar:n.avatar,type:"sequence_auto",status:x===0?"pending":"scheduled",dueDate:D.toISOString(),priority:"medium",sequenceId:`ai_${t}`,sequenceStep:c+1,sequenceStepId:p.id,aiReason:`IA: ${a.name} - ${p.name}`,suggestedMessage:M.content,ltv:n.ltv,context:{autoSend:!0,totalSteps:a.templates.length,messageType:M.type,buttons:M.buttons,listItems:M.listItems,aiGenerated:!0}};this.tasks.push(b),console.log(`ðŸ“ Mensagem ${c+1}/${a.templates.length} criada: ${p.name}`)}catch(M){console.error(`Erro ao gerar mensagem ${c+1} da sequÃªncia:`,M);const b=this.getDefaultMessage(n,t),_={id:this.generateId(),contactId:n.id,contactName:n.name,contactPhone:n.phoneNumber,contactAvatar:n.avatar,type:"sequence_auto",status:x===0?"pending":"scheduled",dueDate:D.toISOString(),priority:"medium",sequenceId:`ai_${t}`,sequenceStep:c+1,aiReason:`SequÃªncia automÃ¡tica: ${a.name} (fallback)`,suggestedMessage:b,ltv:n.ltv,context:{autoSend:!0,totalSteps:a.templates.length}};this.tasks.push(_)}}this.save(),console.log(`âœ… SequÃªncia IA "${a.name}" criada com ${a.templates.length} mensagens`)}catch(l){console.error("Erro ao criar sequÃªncia IA:",l)}}handleMessageReceived(t){const o=this.tasks.filter(s=>s.contactId===t.contactId&&s.status==="scheduled"&&s.sequenceId);o.length>0&&(console.log("ðŸ’¬ Cliente respondeu - Pausando sequÃªncia automÃ¡tica:",t.contactId),o.forEach(s=>{s.dueDate=this.addDays(new Date,5).toISOString(),s.notes=(s.notes||"")+" [Pausado - cliente respondeu]"}),this.save())}async startSequence(t,o,s={}){const l=this.sequences.find(n=>n.id===t&&n.active);if(!l){console.warn("SequÃªncia nÃ£o encontrada ou inativa:",t);return}try{const d=(await H.getAll()).find(a=>a.id===o);if(!d){console.warn("Contato nÃ£o encontrado:",o);return}console.log(`ðŸš€ Iniciando sequÃªncia "${l.name}" para ${d.name}`),this.cancelSequence(o,t),l.steps.forEach((a,N)=>{const c=this.addDays(new Date,a.delayDays),p={id:this.generateId(),contactId:d.id,contactName:d.name,contactPhone:d.phoneNumber,contactAvatar:d.avatar,type:"sequence_auto",status:"scheduled",dueDate:c.toISOString(),priority:a.priority,sequenceId:l.id,sequenceStep:N+1,sequenceStepId:a.id,aiReason:`SequÃªncia automÃ¡tica: ${l.name} - Etapa ${N+1}`,suggestedMessage:this.processMessageTemplate(a.messageTemplate,d,s),ltv:d.ltv,context:s};this.tasks.push(p)}),this.save()}catch(n){console.error("Erro ao iniciar sequÃªncia:",n)}}cancelSequence(t,o){const s=this.tasks.length;this.tasks=this.tasks.filter(l=>!(l.contactId===t&&l.status==="scheduled"&&(!o||l.sequenceId===o))),this.tasks.length!==s&&(console.log(`ðŸš« Canceladas ${s-this.tasks.length} tarefas da sequÃªncia`),this.save())}processMessageTemplate(t,o,s){const l=this.getFirstName(o.name);return t.replace(/\{\{nome\}\}/g,l).replace(/\{\{telefone\}\}/g,o.phoneNumber).replace(/\{\{valor_pedido\}\}/g,s.orderValue?`R$ ${s.orderValue.toLocaleString()}`:"").replace(/\{\{protocolo\}\}/g,s.orderId||`FU-${Date.now()}`).replace(/\{\{saudacao\}\}/g,this.getGreeting())}getGreeting(){const t=new Date().getHours();return t<12?"Bom dia":t<18?"Boa tarde":"Boa noite"}async generateAIMessage(t,o){try{if(!O.isConfigured())return this.getDefaultMessage(t,o);const s=this.getFirstName(t.name),l={contactName:t.name,contactPhone:t.phoneNumber,contactTags:t.tags||[],ltv:t.ltv,lastPurchaseDate:t.lastPurchaseDate,lastPurchaseValue:t.lastPurchaseValue,lastPurchaseProducts:t.lastPurchaseProducts,kanbanStage:t.kanbanStage,daysSinceLastPurchase:t.lastPurchaseDate?this.daysSince(t.lastPurchaseDate):void 0,totalPurchases:t.totalPurchases,averageOrderValue:t.averageOrderValue,preferredProducts:t.preferredProducts,birthday:t.birthday,location:t.location,customFields:t.customFields},d={vip_inactive:"vip_reactivation",kanban_stuck:"lead_nurturing",cold_lead:"lead_nurturing",post_sale:"post_sale_satisfaction",vip_attention:"vip_reactivation",sale_completed:"post_sale_confirmation",cart_abandoned:"cart_abandoned_recovery",birthday:"birthday_celebration"}[o]||"lead_nurturing";return(await O.generateSmartMessage(d,l)).content}catch(s){return console.warn("Erro ao gerar mensagem com IA, usando padrÃ£o:",s),this.getDefaultMessage(t,o)}}getDefaultMessage(t,o){const s=this.getFirstName(t.name);return{vip_inactive:`Oi ${s}! Sentimos sua falta ðŸ˜Š Que tal dar uma olhada nas novidades? Temos uma surpresa especial para vocÃª!`,kanban_stuck:`Oi ${s}! Como estÃ¡ nossa conversa? Posso esclarecer alguma dÃºvida para vocÃª? ðŸ¤`,cold_lead:`OlÃ¡ ${s}! Vi que vocÃª demonstrou interesse em nossos produtos. Posso te ajudar com alguma informaÃ§Ã£o? ðŸ˜Š`,post_sale:`Oi ${s}! Como estÃ¡ seu pedido? Ficou satisfeito? Sua opiniÃ£o Ã© muito importante para nÃ³s! â­`,vip_attention:`${s}, como cliente VIP vocÃª tem acesso exclusivo Ã s nossas melhores ofertas! Vamos conversar? ðŸ‘‘`}[o]||`Oi ${s}! Como posso ajudar vocÃª hoje? ðŸ˜Š`}async processScheduledTasks(){var t;try{const o=new Date,s=this.tasks.filter(l=>l.status==="scheduled"&&new Date(l.dueDate)<=o);console.log(`â° Processando ${s.length} tarefas agendadas`);for(const l of s)if((t=l.context)!=null&&t.autoSend&&l.suggestedMessage)try{console.log(`ðŸ“¤ Enviando mensagem automÃ¡tica para ${l.contactName}`),await this.sendAutomaticMessage(l)?(l.status="completed",l.completedAt=o.toISOString(),l.sentAt=o.toISOString(),l.notes=(l.notes||"")+` [Enviado automaticamente em ${o.toLocaleString("pt-BR")}]`,console.log(`âœ… Mensagem enviada automaticamente para ${l.contactName}`)):(l.status="pending",l.notes=(l.notes||"")+" [Falha no envio automÃ¡tico - requer aÃ§Ã£o manual]",console.log(`âŒ Falha no envio automÃ¡tico para ${l.contactName} - movido para pendente`))}catch(n){console.error(`Erro no envio automÃ¡tico para ${l.contactName}:`,n),l.status="pending",l.notes=(l.notes||"")+` [Erro no envio automÃ¡tico: ${n.message}]`}else l.status="pending",l.notes=(l.notes||"")+` [Agendamento atingido em ${o.toLocaleString("pt-BR")}]`;return s.length>0&&this.save(),s.length}catch(o){return console.error("Erro ao processar tarefas agendadas:",o),0}}async sendAutomaticMessage(t){var o,s,l,n,d;try{const a=((o=t.context)==null?void 0:o.messageType)||"text";let N={phoneNumber:t.contactPhone,messageType:a,content:{}};a==="text"?N.content={text:t.suggestedMessage}:a==="buttons"&&((s=t.context)!=null&&s.buttons)?N.content={text:t.suggestedMessage,buttons:t.context.buttons,footer:t.context.footer}:a==="list"&&((l=t.context)!=null&&l.listItems)?N.content={text:t.suggestedMessage,buttonText:t.context.buttonText||"Ver OpÃ§Ãµes",footer:t.context.footer,sections:t.context.listItems}:a==="carousel"&&((n=t.context)!=null&&n.cards)?N.content=t.context.cards:["image","video","audio"].includes(a)?N.content={caption:t.suggestedMessage,url:(d=t.context)==null?void 0:d.mediaUrl}:N.content={text:t.suggestedMessage};const c=await fetch("http://localhost:3002/api/messages/send-quick",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)});if(c.ok){try{const p=await this.createFollowUpTicket(t.contactId,"default");p&&(t.ticketId=p)}catch(p){console.warn("Erro ao criar ticket automÃ¡tico:",p)}return!0}else{const p=await c.text();return console.error("Erro na API de envio:",p),!1}}catch(a){return console.error("Erro ao enviar mensagem automÃ¡tica:",a),!1}}async createScheduledMessage(t){const o={id:this.generateId(),contactId:t.contactId,contactName:t.contactName,contactPhone:t.contactPhone,contactAvatar:t.contactAvatar,type:"manual",status:"scheduled",dueDate:t.scheduledDate,priority:t.priority,notes:t.notes,aiReason:"Agendamento Manual com Envio AutomÃ¡tico",suggestedMessage:t.message,context:{autoSend:t.autoSend}};return this.tasks.push(o),this.save(),console.log(`ðŸ“… Mensagem agendada para ${new Date(t.scheduledDate).toLocaleString("pt-BR")} - ${t.contactName}`),o}async createMessageSequence(t){const o=`seq_${Date.now()}`,s=new Date,l=[];return t.messages.forEach((n,d)=>{let a;if(d===0)a=new Date(s.getTime()+n.delayMinutes*60*1e3);else{const c=n.delayDays*24*60+n.delayHours*60+n.delayMinutes;a=new Date(s.getTime()+c*60*1e3)}const N={id:this.generateId(),contactId:t.contactId,contactName:t.contactName,contactPhone:t.contactPhone,contactAvatar:t.contactAvatar,type:"sequence_auto",status:"scheduled",dueDate:a.toISOString(),priority:t.priority,notes:t.notes,aiReason:`SequÃªncia AutomÃ¡tica - Mensagem ${d+1}/${t.messages.length}`,suggestedMessage:n.message,sequenceId:o,sequenceStep:d+1,context:{autoSend:t.autoSend,totalSteps:t.messages.length}};l.push(N)}),this.tasks.push(...l),this.save(),console.log(`ðŸ”„ SequÃªncia de ${t.messages.length} mensagens criada para ${t.contactName}`),l}async generateAiTasks(){try{const t=await H.getAll();if(t.length===0){console.log("ðŸ“­ Nenhum contato encontrado - nÃ£o hÃ¡ dados para anÃ¡lise da IA");return}O.isConfigured()||console.log("ðŸ¤– IA nÃ£o configurada - usando mensagens padrÃ£o");const o=[],s=new Date;let l=0,n=0;console.log(`ðŸ” IA analisando ${t.length} contatos para oportunidades...`);for(const a of t)try{if(this.hasRecentMessages(a.id,this.cooldownDays)){n++;continue}l++;const N=this.getFirstName(a.name);if(a.ltv>800&&a.lastPurchaseDate){const c=this.daysSince(a.lastPurchaseDate);if(c>30){const p=await this.generateAIMessage(a,"vip_inactive");o.push({id:this.generateId(),contactId:a.id,contactName:a.name,contactPhone:a.phoneNumber,contactAvatar:a.avatar,type:"ai_recovery",status:"pending",dueDate:s.toISOString(),priority:a.ltv>2e3?"high":"medium",aiReason:`Cliente VIP (LTV R$ ${a.ltv.toLocaleString()}) sem compras hÃ¡ ${c} dias`,suggestedMessage:p,ltv:a.ltv})}}if(a.kanbanStage==="negotiation"||a.kanbanStage==="proposal"){const c=await this.generateAIMessage(a,"kanban_stuck");o.push({id:this.generateId(),contactId:a.id,contactName:a.name,contactPhone:a.phoneNumber,contactAvatar:a.avatar,type:"kanban_stuck",status:"pending",dueDate:this.addDays(s,1).toISOString(),priority:"medium",aiReason:`Parado na etapa "${a.kanbanStage}" - precisa de follow-up`,suggestedMessage:c,kanbanStage:a.kanbanStage})}if(a.kanbanStage==="lead"&&a.status==="active"){const c=await this.generateAIMessage(a,"cold_lead");o.push({id:this.generateId(),contactId:a.id,contactName:a.name,contactPhone:a.phoneNumber,contactAvatar:a.avatar,type:"cold_lead",status:"pending",dueDate:this.addDays(s,2).toISOString(),priority:"low",aiReason:"Lead sem interaÃ§Ã£o - oportunidade de aquecimento",suggestedMessage:c})}if(a.lastPurchaseDate){const c=this.daysSince(a.lastPurchaseDate);if(c>=7&&c<=15){const p=await this.generateAIMessage(a,"post_sale");o.push({id:this.generateId(),contactId:a.id,contactName:a.name,contactPhone:a.phoneNumber,contactAvatar:a.avatar,type:"post_sale",status:"pending",dueDate:this.addDays(s,1).toISOString(),priority:"low",aiReason:`Comprou hÃ¡ ${c} dias - momento ideal para feedback`,suggestedMessage:p})}}if(a.tags.includes("VIP")&&!a.lastPurchaseDate){const c=await this.generateAIMessage(a,"vip_attention");o.push({id:this.generateId(),contactId:a.id,contactName:a.name,contactPhone:a.phoneNumber,contactAvatar:a.avatar,type:"vip_attention",status:"pending",dueDate:s.toISOString(),priority:"high",aiReason:"Cliente VIP sem histÃ³rico de compras - atenÃ§Ã£o especial necessÃ¡ria",suggestedMessage:c,ltv:a.ltv})}}catch(N){console.warn(`Erro ao processar contato ${a.name}:`,N)}const d=o.filter((a,N,c)=>N===c.findIndex(p=>p.contactId===a.contactId&&p.type===a.type));if(d.length===0){console.log(`âœ… IA analisou ${l} contatos (${n} em cooldown) - Nenhuma oportunidade crÃ­tica encontrada`);return}console.log(`ðŸŽ¯ IA detectou ${d.length} oportunidades de follow-up (${l} analisados, ${n} em cooldown de ${this.cooldownDays} dias)`),this.tasks=[...this.tasks,...d],this.save()}catch(t){console.error("Erro ao gerar tarefas de IA:",t)}}getAll(){try{return[...this.tasks].sort((t,o)=>{const s={high:3,medium:2,low:1},l=s[o.priority]-s[t.priority];return l!==0?l:new Date(t.dueDate).getTime()-new Date(o.dueDate).getTime()})}catch(t){return console.error("Erro ao obter tarefas:",t),[]}}getStats(){try{const t=this.tasks.filter(d=>d.status==="pending"),o=this.tasks.filter(d=>d.status==="scheduled"),s=new Date().toDateString(),l=this.tasks.filter(d=>d.status==="completed"&&d.completedAt&&new Date(d.completedAt).toDateString()===s).length,n=[...t,...o].filter(d=>d.priority==="high"&&d.ltv).reduce((d,a)=>d+(a.ltv||0),0);return{pending:t.length,scheduled:o.length,completedToday:l,highPriority:[...t,...o].filter(d=>d.priority==="high").length,recoveryPotential:n,activeSequences:this.getActiveSequencesCount()}}catch(t){return console.error("Erro ao calcular estatÃ­sticas:",t),{pending:0,scheduled:0,completedToday:0,highPriority:0,recoveryPotential:0,activeSequences:0}}}getActiveSequencesCount(){return new Set(this.tasks.filter(o=>o.status==="scheduled"&&o.sequenceId).map(o=>o.contactId)).size}completeTask(t){const o=this.tasks.find(s=>s.id===t);o&&(o.status="completed",o.completedAt=new Date().toISOString(),o.sequenceId&&this.cancelSequence(o.contactId,o.sequenceId),this.save())}snoozeTask(t,o){const s=this.tasks.find(l=>l.id===t);if(s){const l=new Date;l.setDate(l.getDate()+o),s.dueDate=l.toISOString(),this.save()}}createManualTask(t){const o={id:this.generateId(),contactId:t.contactId,contactName:t.contactName,contactPhone:t.contactPhone,contactAvatar:t.contactAvatar||"",type:"manual",status:"pending",dueDate:t.dueDate||new Date().toISOString(),priority:t.priority||"medium",notes:t.notes,aiReason:"Agendamento Manual"};return this.tasks.push(o),this.save(),o}async createFollowUpTicket(t,o){try{const s=await fetch("/api/tickets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contact_id:t,instance_id:o,subject:"Follow-up Respondido",priority:"normal",origin:"followup",tags:["follow-up"]})});return s.ok?(await s.json()).id:null}catch(s){return console.error("Erro ao criar ticket de follow-up:",s),null}}async sendFollowUpMessage(t,o){const s=this.tasks.find(l=>l.id===t);if(!s)return!1;try{return(await fetch("http://localhost:3002/api/messages/send-quick",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:s.contactPhone,messageType:o.type,content:o.content})})).ok?(s.status="completed",s.completedAt=new Date().toISOString(),this.save(),!0):!1}catch(l){return console.error("Erro ao enviar mensagem de follow-up:",l),!1}}triggerSaleCompleted(t,o,s,l){window.dispatchEvent(new CustomEvent("sale_completed",{detail:{contactId:t,orderId:o,value:s,products:l}}))}triggerCampaignResponse(t,o,s){window.dispatchEvent(new CustomEvent("campaign_response",{detail:{contactId:t,campaignId:o,messageId:s}}))}triggerCartAbandoned(t,o,s,l){window.dispatchEvent(new CustomEvent("cart_abandoned",{detail:{contactId:t,cartId:o,items:s,totalValue:l}}))}triggerMessageReceived(t,o,s){window.dispatchEvent(new CustomEvent("message_received",{detail:{contactId:t,messageId:o,content:s}}))}triggerBirthday(t){window.dispatchEvent(new CustomEvent("birthday",{detail:{contactId:t}}))}async createManualAISequence(t,o,s){try{await this.createAISequence(o,t,s),console.log(`ðŸŽ¯ SequÃªncia IA manual criada: ${o} para contato ${t}`)}catch(l){throw console.error("Erro ao criar sequÃªncia IA manual:",l),l}}getSequences(){return[...this.sequences]}getActiveSequences(){return this.sequences.filter(t=>t.active)}updateSequence(t,o){const s=this.sequences.findIndex(l=>l.id===t);s!==-1&&(this.sequences[s]={...this.sequences[s],...o},this.save())}getTasksBySequence(t){return this.tasks.filter(o=>o.sequenceId===t)}cleanupOldTasks(){const t=new Date;t.setDate(t.getDate()-30);const o=this.tasks.length;this.tasks=this.tasks.filter(s=>s.status==="completed"&&s.completedAt?new Date(s.completedAt)>t:!0),this.tasks.length!==o&&(this.save(),console.log(`Limpeza: ${o-this.tasks.length} tarefas antigas removidas`))}clearAllTasks(){this.tasks=[],this.save(),console.log("ðŸ§¹ Todas as tarefas foram removidas")}setCooldownDays(t){if(t<1||t>30){console.warn("Cooldown deve estar entre 1 e 30 dias");return}this.cooldownDays=t,console.log(`â° Cooldown configurado para ${t} dias`)}getCooldownDays(){return this.cooldownDays}isContactInCooldown(t){return this.hasRecentMessages(t,this.cooldownDays)}getCooldownStats(){try{const t=this.tasks.map(l=>l.contactId),o=[...new Set(t)],s=o.filter(l=>this.hasRecentMessages(l,this.cooldownDays));return{totalContacts:o.length,contactsInCooldown:s.length,contactsAvailable:o.length-s.length,cooldownDays:this.cooldownDays}}catch(t){return console.error("Erro ao calcular estatÃ­sticas de cooldown:",t),{totalContacts:0,contactsInCooldown:0,contactsAvailable:0,cooldownDays:this.cooldownDays}}}startAutomation(){try{setInterval(()=>{this.processScheduledTasks()},3e4),setInterval(()=>{this.cleanupOldTasks()},1440*60*1e3),console.log("ðŸ¤– Follow-up automÃ¡tico iniciado (processamento a cada 30s)")}catch(t){console.error("Erro ao iniciar automaÃ§Ã£o:",t)}}}const $=new lt;if(typeof window<"u")try{$.startAutomation(),console.log("ðŸ¤– Sistema de follow-up iniciado")}catch(i){console.warn("Erro ao iniciar automaÃ§Ã£o do FollowUp:",i)}const rt=i=>{switch(i){case"ai_recovery":return{icon:We,label:"RecuperaÃ§Ã£o VIP",color:"text-purple-700",bg:"bg-purple-50",border:"border-purple-200"};case"kanban_stuck":return{icon:Ze,label:"Travado no Funil",color:"text-orange-700",bg:"bg-orange-50",border:"border-orange-200"};case"cold_lead":return{icon:Be,label:"Lead Frio",color:"text-blue-700",bg:"bg-blue-50",border:"border-blue-200"};case"vip_attention":return{icon:ot,label:"AtenÃ§Ã£o VIP",color:"text-yellow-700",bg:"bg-yellow-50",border:"border-yellow-200"};case"post_sale":return{icon:oe,label:"PÃ³s-venda",color:"text-green-700",bg:"bg-green-50",border:"border-green-200"};default:return{icon:Y,label:"SugestÃ£o IA",color:"text-gray-700",bg:"bg-gray-50",border:"border-gray-200"}}};function it({tasks:i,onAction:t}){const o=i.filter(s=>s.status==="pending"&&["ai_recovery","kanban_stuck","cold_lead","vip_attention","post_sale"].includes(s.type));return o.length===0?e.jsxDEV("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400 bg-white rounded-xl border border-dashed border-gray-200",children:[e.jsxDEV(Y,{size:48,className:"mb-4 text-emerald-300"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:74,columnNumber:9},this),e.jsxDEV("p",{className:"text-center font-medium",children:"Nenhuma oportunidade detectada."},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:75,columnNumber:9},this),e.jsxDEV("p",{className:"text-xs text-gray-400 mt-2 max-w-sm text-center",children:"A IA analisarÃ¡ seus contatos e sugerirÃ¡ aÃ§Ãµes aqui."},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:76,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:73,columnNumber:7},this):e.jsxDEV("div",{className:"space-y-6",children:[e.jsxDEV("div",{className:"flex items-center gap-2 mb-6",children:[e.jsxDEV(Y,{className:"text-purple-600",size:20},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:86,columnNumber:9},this),e.jsxDEV("div",{children:[e.jsxDEV("h3",{className:"font-bold text-gray-800 text-lg",children:"Radar de Oportunidades"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:88,columnNumber:11},this),e.jsxDEV("p",{className:"text-sm text-gray-500",children:[o.length," oportunidades encontradas"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:89,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:87,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:85,columnNumber:7},this),e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(s=>{const l=rt(s.type),n=l.icon;return e.jsxDEV("div",{className:"bg-white rounded-xl border border-gray-200 p-4 shadow-sm hover:shadow-md transition-shadow relative",children:[e.jsxDEV("div",{className:"flex justify-between items-start mb-3",children:[e.jsxDEV("div",{className:"flex items-center gap-3",children:[e.jsxDEV(ce,{name:s.contactName,size:"sm"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:106,columnNumber:19},this),e.jsxDEV("div",{children:[e.jsxDEV("h4",{className:"font-bold text-gray-800 text-sm",children:s.contactName},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:108,columnNumber:21},this),e.jsxDEV("span",{className:U("text-[10px] uppercase font-bold px-2 py-0.5 rounded-full inline-flex items-center gap-1 mt-1",l.bg,l.color),children:[e.jsxDEV(n,{size:10},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:112,columnNumber:23},this),l.label]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:109,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:107,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:105,columnNumber:17},this),s.ltv&&e.jsxDEV("div",{className:"text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-lg border border-emerald-100 flex items-center gap-1",children:[e.jsxDEV(ze,{size:10},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:119,columnNumber:21},this)," ",s.ltv.toLocaleString()]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:118,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:104,columnNumber:15},this),e.jsxDEV("div",{className:"mb-4 space-y-3",children:[e.jsxDEV("div",{className:"text-xs text-gray-600 bg-gray-50 p-2.5 rounded-lg border border-gray-100 italic",children:['"',s.aiReason,'"']},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:126,columnNumber:17},this),e.jsxDEV("div",{children:[e.jsxDEV("p",{className:"text-[10px] uppercase font-bold text-gray-400 mb-1",children:"SugestÃ£o:"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:131,columnNumber:19},this),e.jsxDEV("div",{className:"text-xs text-gray-700 bg-blue-50/50 p-2 rounded border border-blue-100",children:s.suggestedMessage},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:132,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:130,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:125,columnNumber:15},this),e.jsxDEV("div",{className:"flex gap-2 mt-auto pt-2 border-t border-gray-50",children:[e.jsxDEV("button",{onClick:()=>t(s,"quick_send"),className:"flex-1 bg-emerald-600 text-white py-2 rounded-lg text-xs font-bold hover:bg-emerald-700 flex items-center justify-center gap-2 transition-colors",children:[e.jsxDEV(oe,{size:14},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:144,columnNumber:19},this)," Enviar Mensagem"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:140,columnNumber:17},this),e.jsxDEV("button",{onClick:()=>t(s,"snooze"),className:"px-3 py-2 border border-gray-200 text-gray-500 rounded-lg hover:bg-gray-50 transition-colors",title:"Adiar",children:e.jsxDEV(je,{size:14},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:151,columnNumber:19},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:146,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:139,columnNumber:15},this)]},s.id,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:99,columnNumber:13},this)})},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:93,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/AiOpportunities.tsx",lineNumber:84,columnNumber:5},this)}const dt=({size:i=16})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},r.createElement("path",{d:"m15 18-6-6 6-6"})),ct=({size:i=16})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},r.createElement("path",{d:"m9 18 6-6-6-6"})),ut=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M8 2v4"}),r.createElement("path",{d:"M16 2v4"}),r.createElement("rect",{width:"18",height:"18",x:"3",y:"4",rx:"2"}),r.createElement("path",{d:"M3 10h18"}));function mt({tasks:i}){const[t,o]=r.useState(new Date),s=new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),l=new Date(t.getFullYear(),t.getMonth(),1).getDay(),n=Array.from({length:s},(c,p)=>p+1),d=Array.from({length:l},(c,p)=>p),a=c=>i.filter(p=>{const x=new Date(p.dueDate);return x.getDate()===c&&x.getMonth()===t.getMonth()&&x.getFullYear()===t.getFullYear()&&p.status==="pending"}),N=c=>{o(p=>{const x=new Date(p);return c==="prev"?x.setMonth(p.getMonth()-1):x.setMonth(p.getMonth()+1),x})};return e.jsxDEV("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden h-full flex flex-col",children:[e.jsxDEV("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsxDEV("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[e.jsxDEV(ut,{size:18,className:"text-emerald-600"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:69,columnNumber:13},this),t.toLocaleDateString("pt-BR",{month:"long",year:"numeric"})]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:68,columnNumber:9},this),e.jsxDEV("div",{className:"flex gap-1",children:[e.jsxDEV("button",{onClick:()=>N("prev"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"MÃªs anterior",children:e.jsxDEV(dt,{size:20},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:78,columnNumber:15},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:73,columnNumber:13},this),e.jsxDEV("button",{onClick:()=>N("next"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"PrÃ³ximo mÃªs",children:e.jsxDEV(ct,{size:20},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:85,columnNumber:15},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:80,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:72,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:67,columnNumber:7},this),e.jsxDEV("div",{className:"grid grid-cols-7 bg-gray-50 border-b border-gray-200",children:["Dom","Seg","Ter","Qua","Qui","Sex","SÃ¡b"].map(c=>e.jsxDEV("div",{className:"py-2 text-center text-xs font-bold text-gray-500 uppercase",children:c},c,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:92,columnNumber:13},this))},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:90,columnNumber:7},this),e.jsxDEV("div",{className:"grid grid-cols-7 flex-1 auto-rows-fr bg-gray-200 gap-px border-b border-gray-200",children:[d.map(c=>e.jsxDEV("div",{className:"bg-white min-h-[100px]"},`blank-${c}`,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:99,columnNumber:26},this)),n.map(c=>{const p=a(c),x=c===new Date().getDate()&&t.getMonth()===new Date().getMonth()&&t.getFullYear()===new Date().getFullYear();return e.jsxDEV("div",{className:U("bg-white p-2 min-h-[100px] hover:bg-gray-50 transition-colors relative group",x&&"bg-blue-50/30"),children:[e.jsxDEV("span",{className:U("text-xs font-medium w-6 h-6 flex items-center justify-center rounded-full mb-1",x?"bg-blue-600 text-white":"text-gray-500"),children:c},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:109,columnNumber:21},this),e.jsxDEV("div",{className:"space-y-1 overflow-y-auto max-h-[80px] scrollbar-none",children:p.map(D=>e.jsxDEV("div",{className:U("text-[10px] px-1.5 py-1 rounded border truncate cursor-pointer transition-all hover:scale-105",D.priority==="high"?"bg-red-50 border-red-100 text-red-700":D.type==="ai_recovery"?"bg-purple-50 border-purple-100 text-purple-700":"bg-gray-100 border-gray-200 text-gray-600"),title:`${D.contactName} - ${D.aiReason||D.notes||"Follow-up"}`,children:[D.type==="ai_recovery"&&"ðŸ¤– ",D.contactName.split(" ")[0]]},D.id,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:116,columnNumber:29},this))},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:114,columnNumber:21},this),e.jsxDEV("button",{className:"absolute bottom-1 right-1 opacity-0 group-hover:opacity-100 bg-emerald-500 text-white w-5 h-5 rounded flex items-center justify-center text-xs shadow-sm transition-opacity",title:"Adicionar tarefa",children:"+"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:130,columnNumber:21},this)]},c,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:108,columnNumber:17},this)})]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:98,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpCalendar.tsx",lineNumber:66,columnNumber:5},this)}const xe=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M9 11l3 3l8-8"}),r.createElement("path",{d:"m21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9c2.12 0 4.07.74 5.61 1.98"})),fe=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("circle",{cx:"12",cy:"12",r:"10"}),r.createElement("polyline",{points:"12,6 12,12 16,14"})),pt=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"m22 2-7 20-4-9-9-4Z"}),r.createElement("path",{d:"M22 2 11 13"}));function ht({tasks:i,onAction:t}){const[o,s]=r.useState("all"),l=r.useMemo(()=>{let n=i.filter(d=>d.status==="pending"||d.status==="scheduled");return o==="high"?n=n.filter(d=>d.priority==="high"):o==="ai"&&(n=n.filter(d=>d.type==="ai_recovery"||d.type==="kanban_stuck")),n.sort((d,a)=>{const N=d.status==="scheduled"&&new Date(d.dueDate)>new Date,c=a.status==="scheduled"&&new Date(a.dueDate)>new Date;if(N!==c)return N?1:-1;const p={high:3,medium:2,low:1},x=p[a.priority]-p[d.priority];return x!==0?x:new Date(d.dueDate).getTime()-new Date(a.dueDate).getTime()})},[i,o]);return e.jsxDEV("div",{className:"space-y-4",children:[e.jsxDEV("div",{className:"flex gap-2 mb-4",children:[e.jsxDEV("button",{onClick:()=>s("all"),className:U("px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",o==="all"?"bg-gray-900 text-white":"bg-white border border-gray-200 text-gray-600 hover:bg-gray-50"),children:["Todas (",i.filter(n=>n.status==="pending"||n.status==="scheduled").length,")"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:70,columnNumber:9},this),e.jsxDEV("button",{onClick:()=>s("high"),className:U("px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",o==="high"?"bg-red-600 text-white":"bg-white border border-gray-200 text-gray-600 hover:bg-gray-50"),children:["Alta Prioridade (",i.filter(n=>(n.status==="pending"||n.status==="scheduled")&&n.priority==="high").length,")"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:79,columnNumber:9},this),e.jsxDEV("button",{onClick:()=>s("ai"),className:U("px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",o==="ai"?"bg-purple-600 text-white":"bg-white border border-gray-200 text-gray-600 hover:bg-gray-50"),children:["SugestÃµes IA (",i.filter(n=>(n.status==="pending"||n.status==="scheduled")&&(n.type==="ai_recovery"||n.type==="kanban_stuck")).length,")"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:88,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:69,columnNumber:7},this),e.jsxDEV("div",{className:"space-y-3",children:[l.length===0&&e.jsxDEV("div",{className:"text-center py-10 text-gray-400",children:[e.jsxDEV(xe,{size:48,className:"mx-auto mb-3 text-emerald-200"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:102,columnNumber:17},this),e.jsxDEV("p",{children:o==="all"?"Nenhuma tarefa pendente. Bom trabalho!":o==="high"?"Nenhuma tarefa de alta prioridade!":"Nenhuma sugestÃ£o da IA no momento."},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:103,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:101,columnNumber:13},this),l.map(n=>{var c,p;const d=n.status==="scheduled",a=d?new Date(n.dueDate):null,N=(c=n.context)==null?void 0:c.autoSend;return e.jsxDEV("div",{className:`bg-white p-4 rounded-xl border shadow-sm flex items-center gap-4 hover:shadow-md transition-all group ${d?"border-blue-200 bg-blue-50":"border-gray-200"}`,children:[e.jsxDEV("button",{onClick:()=>t(n,"complete"),className:"w-6 h-6 rounded-full border-2 border-gray-300 hover:border-emerald-500 hover:bg-emerald-50 flex items-center justify-center text-emerald-600 transition-colors",disabled:d,children:e.jsxDEV(xe,{size:14,className:`${d?"opacity-30":"opacity-0 hover:opacity-100"}`},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:125,columnNumber:21},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:120,columnNumber:17},this),e.jsxDEV("div",{className:"flex-1 min-w-0",children:[e.jsxDEV("div",{className:"flex justify-between items-start",children:[e.jsxDEV("h4",{className:"font-bold text-gray-800 text-sm truncate",children:n.contactName},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:130,columnNumber:25},this),e.jsxDEV("div",{className:"flex items-center gap-2",children:[d&&e.jsxDEV("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-bold uppercase bg-blue-100 text-blue-700 border border-blue-200",children:N?"Auto-Envio":"Agendado"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:133,columnNumber:29},this),e.jsxDEV("span",{className:U("text-[10px] px-2 py-0.5 rounded-full font-bold uppercase",n.priority==="high"?"bg-red-100 text-red-700":n.priority==="medium"?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"),children:n.priority==="high"?"Alta":n.priority==="medium"?"MÃ©dia":"Baixa"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:137,columnNumber:27},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:131,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:129,columnNumber:21},this),e.jsxDEV("p",{className:"text-xs text-gray-500 mt-0.5 flex items-center gap-1",children:[n.type==="ai_recovery"&&e.jsxDEV("span",{className:"text-purple-600 font-bold",children:"IA:"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:148,columnNumber:57},this),n.aiReason||n.notes||"Follow-up de rotina"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:147,columnNumber:21},this),e.jsxDEV("div",{className:"flex items-center gap-2 mt-2 text-[10px] text-gray-400",children:[e.jsxDEV(fe,{size:12},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:153,columnNumber:25},this),d&&a?e.jsxDEV("span",{className:"text-blue-600 font-medium",children:[a.toLocaleDateString("pt-BR")," Ã s ",a.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:155,columnNumber:27},this):new Date(n.dueDate).toLocaleDateString("pt-BR"),n.kanbanStage&&e.jsxDEV("span",{className:"bg-gray-100 px-1.5 rounded text-gray-600 border border-gray-200 capitalize",children:["Funil: ",n.kanbanStage]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:162,columnNumber:29},this),n.ltv&&e.jsxDEV("span",{className:"bg-emerald-50 px-1.5 rounded text-emerald-700 border border-emerald-200 font-bold",children:["LTV: R$ ",n.ltv.toFixed(0)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:167,columnNumber:29},this),n.sequenceId&&e.jsxDEV("span",{className:"bg-purple-50 px-1.5 rounded text-purple-700 border border-purple-200 font-bold",children:["Seq: ",n.sequenceStep,"/",((p=n.context)==null?void 0:p.totalSteps)||"?"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:172,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:152,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:128,columnNumber:17},this),e.jsxDEV("div",{className:`flex items-center gap-2 transition-opacity ${d?"opacity-50":"opacity-0 group-hover:opacity-100"}`,children:[e.jsxDEV("button",{onClick:()=>t(n,"quick_send"),className:"p-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100",title:d?"Agendado para envio automÃ¡tico":"Envio RÃ¡pido",disabled:d,children:e.jsxDEV(pt,{size:18},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:188,columnNumber:25},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:182,columnNumber:21},this),e.jsxDEV("button",{onClick:()=>t(n,"chat"),className:"p-2 bg-emerald-50 text-emerald-600 rounded-lg hover:bg-emerald-100",title:"Abrir Chat",children:e.jsxDEV(oe,{size:18},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:194,columnNumber:25},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:190,columnNumber:21},this),e.jsxDEV("button",{onClick:()=>t(n,"snooze"),className:"p-2 bg-gray-50 text-gray-600 rounded-lg hover:bg-gray-100",title:d?"Cancelar agendamento":"Adiar (+1 dia)",children:e.jsxDEV(fe,{size:18},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:201,columnNumber:25},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:196,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:179,columnNumber:17},this)]},n.id,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:117,columnNumber:13},this)})]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:99,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/TaskList.tsx",lineNumber:67,columnNumber:5},this)}const Nt=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M18 6 6 18"}),r.createElement("path",{d:"m6 6 12 12"})),gt=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})),bt=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"m4 4 7.07 17 2.51-7.39L21 11.07z"})),vt=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("line",{x1:"8",x2:"21",y1:"6",y2:"6"}),r.createElement("line",{x1:"8",x2:"21",y1:"12",y2:"12"}),r.createElement("line",{x1:"8",x2:"21",y1:"18",y2:"18"}),r.createElement("line",{x1:"3",x2:"3.01",y1:"6",y2:"6"}),r.createElement("line",{x1:"3",x2:"3.01",y1:"12",y2:"12"}),r.createElement("line",{x1:"3",x2:"3.01",y1:"18",y2:"18"})),Ce=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"m22 2-7 20-4-9-9-4Z"}),r.createElement("path",{d:"M22 2 11 13"})),ye=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M5 12h14"}),r.createElement("path",{d:"m12 5 0 14"})),te=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M3 6h18"}),r.createElement("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),r.createElement("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),r.createElement("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),r.createElement("line",{x1:"14",x2:"14",y1:"11",y2:"17"})),wt=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M8 21s-4-3-4-9 4-9 4-9"}),r.createElement("path",{d:"m16 3 4 9-4 9"})),xt=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),r.createElement("polyline",{points:"7,10 12,15 17,10"}),r.createElement("line",{x1:"12",x2:"12",y1:"15",y2:"3"})),Se=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),r.createElement("circle",{cx:"9",cy:"9",r:"2"}),r.createElement("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})),De=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"m22 8-6 4 6 4V8Z"}),r.createElement("rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2"})),Ee=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),r.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),r.createElement("line",{x1:"12",x2:"12",y1:"19",y2:"22"})),ft=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M2 7v10"}),r.createElement("path",{d:"M6 5v14"}),r.createElement("rect",{width:"12",height:"18",x:"10",y:"3",rx:"2"})),se=({onInsert:i})=>r.createElement("div",{className:"flex gap-2 mt-1.5 overflow-x-auto pb-1 scrollbar-thin scrollbar-thumb-gray-200"},["nome","telefone","protocolo","saudacao"].map(t=>r.createElement("button",{key:t,type:"button",onClick:()=>i(t),className:"text-[10px] bg-emerald-50 text-emerald-700 px-2 py-1 rounded border border-emerald-100 hover:bg-emerald-100 transition-colors whitespace-nowrap font-medium flex items-center gap-1"},r.createElement(wt,{size:10}),` {{${t}}}`)));function Ct({isOpen:i,onClose:t,contactId:o,contactName:s,contactPhone:l,suggestedMessage:n,taskId:d}){const[a,N]=r.useState("text"),[c,p]=r.useState(!1),[x,D]=r.useState([]),{success:M,error:b,info:_}=He(),f=(u,h="info")=>{h==="success"?M("Sucesso",u):h==="error"?b("Erro",u):_("InformaÃ§Ã£o",u)},[S,A]=r.useState(n||""),[j,P]=r.useState(""),[Q,R]=r.useState(""),[E,I]=r.useState([{id:"btn_1",text:"Sim, quero!",type:"quick_reply"}]),[T,z]=r.useState(""),[Z,J]=r.useState(""),[X,K]=r.useState("Abrir Menu"),[V,q]=r.useState([{title:"SeÃ§Ã£o Principal",rows:[{id:"row_1",title:"OpÃ§Ã£o 1",description:""}]}]),[m,C]=r.useState([{title:"Card 1",body:"DescriÃ§Ã£o do primeiro card",buttons:[{text:"Ver mais"}]}]),[F,G]=r.useState(null),[ue,me]=r.useState(""),[ne,pe]=r.useState(null),he=r.useRef(null),Ne=r.useRef(null),ge=r.useRef(null),be=r.useRef(null);r.useEffect(()=>{if(i&&(ke(),n&&a==="text")){const u=s.split(" ")[0],h=n.replace(/\{\{nome\}\}/g,u);A(h)}},[i,n,s]);const ke=async()=>{try{const u=await Xe.getAll();D(u)}catch(u){console.error("Erro ao carregar templates:",u),D([])}},Ie=u=>{const h=x.find(g=>g.id===u);if(!h)return;N(h.type);const v=h.content;h.type==="text"&&A(v.text),h.type==="buttons"&&(P(v.text),R(v.footer),I(v.buttons)),h.type==="list"&&(z(v.text),K(v.buttonText),J(v.footer),q(v.sections))},ae=(u,h,v,g)=>{const w=` {{${u}}} `,y=g==null?void 0:g.current;if(!y){v(h+w);return}const k=y.selectionStart||0,ee=y.selectionEnd||0,$e=h.substring(0,k)+w+h.substring(ee);v($e),setTimeout(()=>{y.focus(),y.setSelectionRange(k+w.length,k+w.length)},0)},Te=u=>{var w;const h=(w=u.target.files)==null?void 0:w[0];if(!h)return;const v={image:["image/jpeg","image/jpg","image/png","image/gif","image/webp"],video:["video/mp4","video/webm","video/avi","video/mov"],audio:["audio/mp3","audio/wav","audio/ogg","audio/m4a","audio/webm"]};let g=null;for(const[y,k]of Object.entries(v))if(k.includes(h.type)){g=y;break}if(!g){f("Tipo de arquivo nÃ£o suportado","error");return}if(h.size>10*1024*1024){f("Arquivo muito grande. MÃ¡ximo 10MB","error");return}if(G(h),N(g),g==="image"||g==="video"){const y=new FileReader;y.onload=k=>{var ee;return pe((ee=k.target)==null?void 0:ee.result)},y.readAsDataURL(h)}else pe(null)},Ae=()=>{const u=s.split(" ")[0],h=w=>w?w.replace(/\{\{nome\}\}/g,u).replace(/\{\{telefone\}\}/g,l).replace(/\{\{protocolo\}\}/g,`FU-${Date.now()}`).replace(/\{\{saudacao\}\}/g,v()):"",v=()=>{const w=new Date().getHours();return w<12?"Bom dia":w<18?"Boa tarde":"Boa noite"},g={type:a,content:{}};switch(a){case"text":g.content={text:h(S)};break;case"buttons":g.content={text:h(j),footer:h(Q),buttons:E.map(w=>({id:w.id,text:w.text,type:w.type}))};break;case"list":g.content={text:h(T),buttonText:X,footer:h(Z),sections:V};break;case"image":case"video":case"audio":g.content={caption:h(ue)};break;case"carousel":g.content=m.map(w=>({header:{imageMessage:{},title:h(w.title),subtitle:h(w.body),hasMediaAttachment:!1},body:{text:h(w.body)},footer:{text:h(w.footer||"")},buttons:w.buttons.map((y,k)=>({buttonId:`id${k}`,buttonText:{displayText:y.text},type:1}))}));break}return g},qe=async()=>{try{if(p(!0),["image","video","audio"].includes(a)&&!F){f("Selecione um arquivo de mÃ­dia","error");return}const u=Ae();let h;const v={};if(["image","video","audio"].includes(a)&&F){const w=new FormData;w.append("phoneNumber",l),w.append("messageType",a),w.append("content",JSON.stringify(u.content)),w.append("media",F),h=w}else v["Content-Type"]="application/json",h=JSON.stringify({phoneNumber:l,messageType:a,content:u.content});const g=await fetch("http://localhost:3002/api/messages/send-quick",{method:"POST",headers:v,body:h});if(g.ok){const w=await g.json();f("Mensagem enviada com sucesso!","success"),d&&$.completeTask(d),t()}else{const w=await g.text();let y="Erro ao enviar mensagem";try{y=JSON.parse(w).error||y}catch{}f(y,"error")}}catch(u){console.error("Erro ao enviar mensagem:",u),f("Erro ao enviar mensagem","error")}finally{p(!1)}};if(!i)return null;const Pe=()=>e.jsxDEV("div",{className:"space-y-4 animate-in fade-in",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Texto da Mensagem"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:444,columnNumber:9},this),e.jsxDEV("textarea",{ref:Ne,rows:3,className:"w-full p-3 border border-gray-300 rounded-lg text-sm outline-none focus:border-emerald-500",value:j,onChange:u=>P(u.target.value),placeholder:"Digite a mensagem principal..."},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:445,columnNumber:9},this),e.jsxDEV(se,{onInsert:u=>ae(u,j,P,Ne)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:453,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:443,columnNumber:7},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"RodapÃ© (Opcional)"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:456,columnNumber:9},this),e.jsxDEV("input",{type:"text",className:"w-full p-2 border border-gray-300 rounded-lg text-sm outline-none focus:border-emerald-500",value:Q,onChange:u=>R(u.target.value),placeholder:"Ex: Selecione uma opÃ§Ã£o"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:457,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:455,columnNumber:7},this),e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"flex justify-between items-center mb-2",children:[e.jsxDEV("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"BotÃµes (MÃ¡x 3)"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:467,columnNumber:11},this),E.length<3&&e.jsxDEV("button",{type:"button",onClick:()=>I([...E,{id:`btn_${Date.now()}`,text:"",type:"quick_reply"}]),className:"text-xs text-emerald-600 font-bold hover:underline flex items-center gap-1",children:[e.jsxDEV(ye,{size:14},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:474,columnNumber:15},this)," Adicionar"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:469,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:466,columnNumber:9},this),e.jsxDEV("div",{className:"space-y-3",children:E.map((u,h)=>e.jsxDEV("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50",children:e.jsxDEV("div",{className:"flex gap-2 mb-2",children:[e.jsxDEV("input",{type:"text",placeholder:`Texto do BotÃ£o ${h+1}`,className:"flex-1 p-2 border border-gray-300 rounded-lg text-sm outline-none focus:border-emerald-500 bg-white",value:u.text,onChange:v=>{const g=[...E];g[h].text=v.target.value,I(g)}},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:482,columnNumber:17},this),E.length>1&&e.jsxDEV("button",{type:"button",onClick:()=>I(E.filter(v=>v.id!==u.id)),className:"text-red-400 hover:text-red-600 p-2",children:e.jsxDEV(te,{size:18},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:499,columnNumber:21},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:494,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:481,columnNumber:15},this)},u.id,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:480,columnNumber:13},this))},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:478,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:465,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:442,columnNumber:5},this),Le=()=>e.jsxDEV("div",{className:"space-y-4 animate-in fade-in max-h-[300px] overflow-y-auto pr-2",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Texto Principal"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:513,columnNumber:9},this),e.jsxDEV("textarea",{ref:ge,rows:3,className:"w-full p-3 border border-gray-300 rounded-lg text-sm outline-none focus:border-emerald-500",value:T,onChange:u=>z(u.target.value),placeholder:"Digite o texto que aparece antes da lista..."},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:514,columnNumber:9},this),e.jsxDEV(se,{onInsert:u=>ae(u,T,z,ge)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:522,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:512,columnNumber:7},this),e.jsxDEV("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Texto do BotÃ£o"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:526,columnNumber:11},this),e.jsxDEV("input",{type:"text",className:"w-full p-2 border border-gray-300 rounded-lg text-sm outline-none focus:border-emerald-500",value:X,onChange:u=>K(u.target.value)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:527,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:525,columnNumber:9},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"RodapÃ© (Opcional)"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:535,columnNumber:11},this),e.jsxDEV("input",{type:"text",className:"w-full p-2 border border-gray-300 rounded-lg text-sm outline-none focus:border-emerald-500",value:Z,onChange:u=>J(u.target.value)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:536,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:534,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:524,columnNumber:7},this),e.jsxDEV("div",{className:"space-y-4",children:[V.map((u,h)=>e.jsxDEV("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:[e.jsxDEV("div",{className:"flex justify-between items-center mb-2",children:[e.jsxDEV("input",{type:"text",className:"bg-transparent font-bold text-sm text-gray-700 outline-none placeholder-gray-400 w-full",placeholder:"TÃ­tulo da SeÃ§Ã£o",value:u.title,onChange:v=>{const g=[...V];g[h].title=v.target.value,q(g)}},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:549,columnNumber:15},this),V.length>1&&e.jsxDEV("button",{type:"button",onClick:()=>q(V.filter((v,g)=>g!==h)),className:"text-red-400 hover:text-red-600",children:e.jsxDEV(te,{size:14},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:566,columnNumber:19},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:561,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:548,columnNumber:13},this),e.jsxDEV("div",{className:"space-y-2 pl-2 border-l-2 border-gray-200",children:[u.rows.map((v,g)=>e.jsxDEV("div",{className:"flex gap-2 items-start",children:[e.jsxDEV("div",{className:"flex-1 space-y-1",children:[e.jsxDEV("input",{type:"text",placeholder:"Nome da OpÃ§Ã£o",className:"w-full p-1.5 border border-gray-200 rounded text-sm bg-white outline-none focus:border-emerald-500",value:v.title,onChange:w=>{const y=[...V];y[h].rows[g].title=w.target.value,q(y)}},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:575,columnNumber:21},this),e.jsxDEV("input",{type:"text",placeholder:"DescriÃ§Ã£o (opcional)",className:"w-full p-1.5 border border-gray-200 rounded text-xs bg-white outline-none focus:border-emerald-500 text-gray-500",value:v.description,onChange:w=>{const y=[...V];y[h].rows[g].description=w.target.value,q(y)}},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:586,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:574,columnNumber:19},this),e.jsxDEV("button",{type:"button",onClick:()=>{const w=[...V];w[h].rows=w[h].rows.filter((y,k)=>k!==g),q(w)},className:"text-red-400 hover:text-red-600 p-1",children:e.jsxDEV(te,{size:14},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:607,columnNumber:21},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:598,columnNumber:19},this)]},v.id,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:573,columnNumber:17},this)),e.jsxDEV("button",{type:"button",onClick:()=>{const v=[...V];v[h].rows.push({id:`row_${Date.now()}`,title:"",description:""}),q(v)},className:"text-xs text-emerald-600 font-bold hover:underline flex items-center gap-1 mt-2",children:"+ Adicionar OpÃ§Ã£o"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:611,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:571,columnNumber:13},this)]},h,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:547,columnNumber:11},this)),e.jsxDEV("button",{type:"button",onClick:()=>q([...V,{title:"",rows:[]}]),className:"w-full py-2 border border-dashed border-gray-300 text-gray-500 text-xs rounded hover:bg-gray-50 hover:text-emerald-600",children:"+ Nova SeÃ§Ã£o"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:625,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:545,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:511,columnNumber:5},this),Oe=()=>e.jsxDEV("div",{className:"space-y-4 animate-in fade-in max-h-[300px] overflow-y-auto pr-2",children:[m.map((u,h)=>e.jsxDEV("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 mb-2",children:[e.jsxDEV("div",{className:"flex justify-between items-center mb-2",children:[e.jsxDEV("h4",{className:"font-bold text-xs text-gray-500",children:["CARD ",h+1]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:641,columnNumber:13},this),m.length>1&&e.jsxDEV("button",{onClick:()=>C(m.filter((v,g)=>g!==h)),className:"text-red-400",children:e.jsxDEV(te,{size:14},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:644,columnNumber:17},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:643,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:640,columnNumber:11},this),e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV("input",{className:"w-full p-2 border rounded text-sm",placeholder:"TÃ­tulo do Card",value:u.title,onChange:v=>{const g=[...m];g[h].title=v.target.value,C(g)}},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:649,columnNumber:13},this),e.jsxDEV("textarea",{className:"w-full p-2 border rounded text-sm",placeholder:"Corpo do texto",rows:2,value:u.body,onChange:v=>{const g=[...m];g[h].body=v.target.value,C(g)}},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:659,columnNumber:13},this),e.jsxDEV("div",{className:"flex gap-2",children:[e.jsxDEV("button",{type:"button",className:"bg-white border rounded px-2 py-1 text-xs",onClick:()=>{const v=[...m];v[h].buttons.push({text:"BotÃ£o"}),C(v)},children:"+ BotÃ£o"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:671,columnNumber:15},this),u.buttons.map((v,g)=>e.jsxDEV("input",{className:"w-24 p-1 border rounded text-xs",value:v.text,onChange:w=>{const y=[...m];y[h].buttons[g].text=w.target.value,C(y)}},g,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:683,columnNumber:17},this))]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:670,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:648,columnNumber:11},this)]},h,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:639,columnNumber:9},this)),e.jsxDEV("button",{type:"button",className:"w-full py-2 border-dashed border-2 rounded text-gray-500 text-sm",onClick:()=>C([...m,{title:"Novo Card",body:"",buttons:[]}]),children:"+ Adicionar Card"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:698,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:637,columnNumber:5},this);return e.jsxDEV("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxDEV("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden animate-in zoom-in-95 duration-200 flex flex-col max-h-[90vh]",children:[e.jsxDEV("div",{className:"bg-emerald-600 px-6 py-4 flex justify-between items-center text-white shrink-0",children:[e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV(Ce,{className:"h-5 w-5"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:714,columnNumber:13},this),e.jsxDEV("div",{children:[e.jsxDEV("h2",{className:"text-lg font-bold leading-tight",children:"Envio RÃ¡pido"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:716,columnNumber:15},this),e.jsxDEV("p",{className:"text-xs text-emerald-100 opacity-80",children:["Para: ",s]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:717,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:715,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:713,columnNumber:11},this),e.jsxDEV("button",{onClick:t,className:"hover:bg-emerald-700 p-1 rounded transition-colors",children:e.jsxDEV(Nt,{size:20},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:721,columnNumber:13},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:720,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:712,columnNumber:9},this),e.jsxDEV("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxDEV("div",{className:"p-6 space-y-4 overflow-y-auto",children:[e.jsxDEV("div",{className:"flex items-center gap-2 bg-gray-50 p-3 rounded-lg border border-gray-200",children:[e.jsxDEV(xt,{size:16,className:"text-gray-500"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:730,columnNumber:15},this),e.jsxDEV("select",{className:"bg-transparent outline-none font-medium cursor-pointer text-sm flex-1",onChange:u=>Ie(u.target.value),defaultValue:"",children:[e.jsxDEV("option",{value:"",disabled:!0,children:"Carregar Modelo..."},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:736,columnNumber:17},this),x.map(u=>e.jsxDEV("option",{value:u.id,children:u.name},u.id,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:738,columnNumber:19},this))]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:731,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:729,columnNumber:13},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-2",children:"Tipo de Mensagem"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:745,columnNumber:15},this),e.jsxDEV("div",{className:"flex gap-1 p-1 bg-gray-100 rounded-lg overflow-x-auto",children:[{id:"text",icon:gt,label:"Texto"},{id:"buttons",icon:bt,label:"BotÃµes"},{id:"list",icon:vt,label:"Lista"},{id:"carousel",icon:ft,label:"Carrossel"},{id:"image",icon:Se,label:"Imagem"},{id:"video",icon:De,label:"VÃ­deo"},{id:"audio",icon:Ee,label:"Ãudio"}].map(u=>e.jsxDEV("button",{type:"button",onClick:()=>N(u.id),className:U("flex-1 py-2 px-2 rounded-md text-xs font-medium flex flex-col items-center gap-1 transition-all min-w-[60px]",a===u.id?"bg-white text-emerald-600 shadow-sm":"text-gray-500 hover:bg-gray-200"),children:[e.jsxDEV(u.icon,{size:16},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:765,columnNumber:21},this)," ",u.label]},u.id,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:756,columnNumber:19},this))},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:746,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:744,columnNumber:13},this),["image","video","audio"].includes(a)&&e.jsxDEV("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsxDEV("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-2",children:["Selecionar ",a==="image"?"Imagem":a==="video"?"VÃ­deo":"Ãudio"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:774,columnNumber:17},this),e.jsxDEV("input",{ref:be,type:"file",accept:a==="image"?"image/*":a==="video"?"video/*":"audio/*",onChange:Te,className:"hidden"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:778,columnNumber:17},this),e.jsxDEV("button",{type:"button",onClick:()=>{var u;return(u=be.current)==null?void 0:u.click()},className:"w-full p-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-emerald-500 hover:bg-emerald-50 transition-colors flex flex-col items-center gap-2",children:F?e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"text-emerald-600",children:[a==="image"&&e.jsxDEV(Se,{size:24},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:797,columnNumber:53},this),a==="video"&&e.jsxDEV(De,{size:24},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:798,columnNumber:53},this),a==="audio"&&e.jsxDEV(Ee,{size:24},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:799,columnNumber:53},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:796,columnNumber:23},this),e.jsxDEV("span",{className:"text-sm font-medium text-emerald-700",children:F.name},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:801,columnNumber:23},this),e.jsxDEV("span",{className:"text-xs text-gray-500",children:[(F.size/1024/1024).toFixed(2)," MB"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:802,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:795,columnNumber:21},this):e.jsxDEV(e.Fragment,{children:[e.jsxDEV(ye,{size:24,className:"text-gray-400"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:806,columnNumber:23},this),e.jsxDEV("span",{className:"text-sm text-gray-500",children:["Clique para selecionar ",a==="image"?"imagem":a==="video"?"vÃ­deo":"Ã¡udio"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:807,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:805,columnNumber:21},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:789,columnNumber:17},this),ne&&(a==="image"||a==="video")&&e.jsxDEV("div",{className:"mt-3",children:a==="image"?e.jsxDEV("img",{src:ne,alt:"Preview",className:"max-w-full h-32 object-cover rounded-lg"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:818,columnNumber:23},this):e.jsxDEV("video",{src:ne,className:"max-w-full h-32 rounded-lg",controls:!0},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:820,columnNumber:23},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:816,columnNumber:19},this),e.jsxDEV("div",{className:"mt-3",children:[e.jsxDEV("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Legenda (Opcional)"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:827,columnNumber:19},this),e.jsxDEV("textarea",{rows:2,className:"w-full p-2 border border-gray-300 rounded-lg text-sm outline-none focus:border-emerald-500",placeholder:"Digite uma legenda para o arquivo...",value:ue,onChange:u=>me(u.target.value)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:828,columnNumber:19},this),e.jsxDEV(se,{onInsert:u=>me(h=>h+` {{${u}}} `)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:835,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:826,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:773,columnNumber:15},this),e.jsxDEV("div",{className:"bg-white rounded-lg border border-gray-200 p-4 min-h-[200px]",children:[a==="text"&&e.jsxDEV("div",{className:"space-y-2 animate-in fade-in",children:[e.jsxDEV("textarea",{ref:he,rows:5,className:"w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-emerald-500 text-sm",placeholder:"Digite sua mensagem...",value:S,onChange:u=>A(u.target.value)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:844,columnNumber:19},this),e.jsxDEV(se,{onInsert:u=>ae(u,S,A,he)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:852,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:843,columnNumber:17},this),a==="buttons"&&Pe(),a==="list"&&Le(),a==="carousel"&&Oe()]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:841,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:726,columnNumber:11},this),e.jsxDEV("div",{className:"p-4 border-t border-gray-200 bg-gray-50 flex gap-3 shrink-0",children:[e.jsxDEV("button",{type:"button",onClick:t,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-100",children:"Cancelar"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:864,columnNumber:13},this),e.jsxDEV("button",{onClick:qe,disabled:c,className:"flex-1 px-4 py-3 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 flex items-center justify-center gap-2 shadow-sm disabled:opacity-50",children:[c?e.jsxDEV("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:877,columnNumber:17},this):e.jsxDEV(Ce,{size:18},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:879,columnNumber:17},this),c?"Enviando...":"Enviar"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:871,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:863,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:725,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:710,columnNumber:7},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/QuickSendModal.tsx",lineNumber:709,columnNumber:5},this)}const _e=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M18 6 6 18"}),r.createElement("path",{d:"M6 6l12 12"})),yt=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),r.createElement("circle",{cx:"12",cy:"7",r:"4"})),Fe=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("circle",{cx:"12",cy:"12",r:"10"}),r.createElement("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),r.createElement("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})),re=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})),St=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M5 12h14"}),r.createElement("path",{d:"M12 5v14"})),Dt=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("path",{d:"M3 6h18"}),r.createElement("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),r.createElement("path",{d:"M8 6V4c0-1 1-2 2-2h4c0-1 1-2 2-2v2"})),ie=({size:i=16,className:t=""})=>r.createElement("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:t},r.createElement("polygon",{points:"12,2 2,7 12,12 22,7 12,2"}),r.createElement("polyline",{points:"2,17 12,22 22,17"}),r.createElement("polyline",{points:"2,12 12,17 22,12"}));function Et({isOpen:i,onClose:t,onSuccess:o}){const[s,l]=r.useState([]),[n,d]=r.useState(null),[a,N]=r.useState(""),[c,p]=r.useState("medium"),[x,D]=r.useState(""),[M,b]=r.useState(!1),[_,f]=r.useState(""),[S,A]=r.useState("single"),[j,P]=r.useState(""),[Q,R]=r.useState(""),[E,I]=r.useState(""),[T,z]=r.useState([{id:"1",message:"",delayDays:0,delayHours:0,delayMinutes:30}]);r.useEffect(()=>{if(i){Z();const m=new Date;m.setDate(m.getDate()+1),P(m.toISOString().split("T")[0]),R("09:00")}},[i]);const Z=async()=>{try{const m=await H.getAll();console.log("âœ… Successfully loaded",m.length,"contacts from backend"),l(m)}catch(m){console.error("Erro ao carregar contatos:",m),f("Erro ao carregar contatos")}},J=r.useMemo(()=>a?s.filter(m=>m.name.toLowerCase().includes(a.toLowerCase())||m.phoneNumber.includes(a)).slice(0,10):s.slice(0,10),[s,a]),X=()=>{const m={id:Date.now().toString(),message:"",delayDays:1,delayHours:0,delayMinutes:0};z([...T,m])},K=m=>{T.length>1&&z(T.filter(C=>C.id!==m))},V=(m,C,F)=>{z(T.map(G=>G.id===m?{...G,[C]:F}:G))},q=async m=>{if(m.preventDefault(),!!n){b(!0),f("");try{if(S==="single"){if(!j||!Q||!E.trim()){f("Preencha todos os campos obrigatÃ³rios");return}const C=new Date(`${j}T${Q}`);await $.createScheduledMessage({contactId:n.id,contactName:n.name,contactPhone:n.phoneNumber,contactAvatar:n.avatar,message:E,scheduledDate:C.toISOString(),priority:c,notes:x,autoSend:!0})}else{const C=T.filter(F=>F.message.trim());if(C.length===0){f("Adicione pelo menos uma mensagem na sequÃªncia");return}await $.createMessageSequence({contactId:n.id,contactName:n.name,contactPhone:n.phoneNumber,contactAvatar:n.avatar,messages:C,priority:c,notes:x,autoSend:!0})}o(),t(),d(null),N(""),D(""),p("medium"),I(""),z([{id:"1",message:"",delayDays:0,delayHours:0,delayMinutes:30}]),A("single")}catch(C){console.error("Erro ao criar agendamento:",C),f("Erro ao criar agendamento")}finally{b(!1)}}};return i?e.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxDEV("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxDEV("div",{className:"p-6",children:[e.jsxDEV("div",{className:"flex justify-between items-center mb-6",children:[e.jsxDEV("h2",{className:"text-xl font-bold text-gray-800",children:"Novo Agendamento"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:248,columnNumber:13},this),e.jsxDEV("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsxDEV(_e,{size:20,className:"text-gray-500"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:253,columnNumber:15},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:249,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:247,columnNumber:11},this),_&&e.jsxDEV("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsxDEV(Fe,{size:16},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:259,columnNumber:15},this),e.jsxDEV("span",{className:"text-sm",children:_},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:260,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:258,columnNumber:13},this),e.jsxDEV("form",{onSubmit:q,className:"space-y-6",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsxDEV(yt,{size:16,className:"inline mr-1"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:268,columnNumber:17},this),"Contato"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:267,columnNumber:15},this),n?e.jsxDEV("div",{className:"p-3 bg-emerald-50 border border-emerald-200 rounded-lg flex items-center gap-3",children:[e.jsxDEV(ce,{name:n.name,size:"sm"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:312,columnNumber:19},this),e.jsxDEV("div",{className:"flex-1",children:[e.jsxDEV("p",{className:"font-medium text-emerald-800",children:n.name},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:314,columnNumber:21},this),e.jsxDEV("p",{className:"text-sm text-emerald-600",children:n.phoneNumber},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:315,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:313,columnNumber:19},this),e.jsxDEV("button",{type:"button",onClick:()=>d(null),className:"p-1 hover:bg-emerald-100 rounded",children:e.jsxDEV(_e,{size:16,className:"text-emerald-600"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:322,columnNumber:21},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:317,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:311,columnNumber:17},this):e.jsxDEV("div",{children:[e.jsxDEV("input",{type:"text",placeholder:"Buscar contato por nome ou telefone...",value:a,onChange:m=>N(m.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:274,columnNumber:19},this),J.length>0&&e.jsxDEV("div",{className:"mt-2 border border-gray-200 rounded-lg max-h-48 overflow-y-auto",children:J.map(m=>e.jsxDEV("button",{type:"button",onClick:()=>d(m),className:"w-full p-3 text-left hover:bg-gray-50 flex items-center gap-3 border-b border-gray-100 last:border-b-0",children:[e.jsxDEV(ce,{name:m.name,size:"sm"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:291,columnNumber:27},this),e.jsxDEV("div",{className:"flex-1 min-w-0",children:[e.jsxDEV("p",{className:"font-medium text-gray-800 truncate",children:m.name},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:293,columnNumber:29},this),e.jsxDEV("p",{className:"text-sm text-gray-500",children:m.phoneNumber},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:294,columnNumber:29},this),m.tags&&m.tags.length>0&&e.jsxDEV("div",{className:"flex gap-1 mt-1",children:m.tags.slice(0,2).map((C,F)=>e.jsxDEV("span",{className:"text-xs bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded",children:typeof C=="string"?C:C.name||"Tag"},F,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:298,columnNumber:35},this))},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:296,columnNumber:31},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:292,columnNumber:27},this)]},m.id,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:285,columnNumber:25},this))},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:283,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:273,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:266,columnNumber:13},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[e.jsxDEV(ie,{size:16,className:"inline mr-1"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:331,columnNumber:17},this),"Tipo de Agendamento"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:330,columnNumber:15},this),e.jsxDEV("div",{className:"flex gap-3",children:[e.jsxDEV("button",{type:"button",onClick:()=>A("single"),className:`flex-1 p-4 border-2 rounded-lg transition-all ${S==="single"?"border-emerald-500 bg-emerald-50 text-emerald-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxDEV(re,{size:20,className:"mx-auto mb-2"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:344,columnNumber:19},this),e.jsxDEV("div",{className:"text-sm font-medium",children:"Envio Ãšnico"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:345,columnNumber:19},this),e.jsxDEV("div",{className:"text-xs text-gray-500 mt-1",children:"Uma mensagem em data especÃ­fica"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:346,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:335,columnNumber:17},this),e.jsxDEV("button",{type:"button",onClick:()=>A("sequence"),className:`flex-1 p-4 border-2 rounded-lg transition-all ${S==="sequence"?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxDEV(ie,{size:20,className:"mx-auto mb-2"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:357,columnNumber:19},this),e.jsxDEV("div",{className:"text-sm font-medium",children:"SequÃªncia"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:358,columnNumber:19},this),e.jsxDEV("div",{className:"text-xs text-gray-500 mt-1",children:"MÃºltiplas mensagens com intervalos"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:359,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:348,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:334,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:329,columnNumber:13},this),S==="single"&&e.jsxDEV("div",{className:"space-y-4 p-4 bg-emerald-50 border border-emerald-200 rounded-lg",children:[e.jsxDEV("h3",{className:"font-medium text-emerald-800 flex items-center gap-2",children:[e.jsxDEV(re,{size:16},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:368,columnNumber:19},this),"Configurar Envio Ãšnico"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:367,columnNumber:17},this),e.jsxDEV("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:374,columnNumber:21},this),e.jsxDEV("input",{type:"date",value:j,onChange:m=>P(m.target.value),min:new Date().toISOString().split("T")[0],className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",required:!0},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:375,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:373,columnNumber:19},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hora"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:386,columnNumber:21},this),e.jsxDEV("input",{type:"time",value:Q,onChange:m=>R(m.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",required:!0},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:387,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:385,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:372,columnNumber:17},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mensagem"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:398,columnNumber:19},this),e.jsxDEV("textarea",{value:E,onChange:m=>I(m.target.value),placeholder:"Digite a mensagem que serÃ¡ enviada automaticamente...",rows:4,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 resize-none",required:!0},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:399,columnNumber:19},this),e.jsxDEV("div",{className:"text-xs text-gray-500 mt-1",children:[E.length,"/1000 caracteres"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:407,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:397,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:366,columnNumber:15},this),S==="sequence"&&e.jsxDEV("div",{className:"space-y-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsxDEV("div",{className:"flex justify-between items-center",children:[e.jsxDEV("h3",{className:"font-medium text-purple-800 flex items-center gap-2",children:[e.jsxDEV(ie,{size:16},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:419,columnNumber:21},this),"Configurar SequÃªncia (",T.length," mensagens)"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:418,columnNumber:19},this),e.jsxDEV("button",{type:"button",onClick:X,className:"px-3 py-1 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm flex items-center gap-1",children:[e.jsxDEV(St,{size:14},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:427,columnNumber:21},this),"Adicionar"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:422,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:417,columnNumber:17},this),e.jsxDEV("div",{className:"space-y-4",children:T.map((m,C)=>e.jsxDEV("div",{className:"bg-white p-4 border border-purple-200 rounded-lg",children:[e.jsxDEV("div",{className:"flex justify-between items-center mb-3",children:[e.jsxDEV("span",{className:"text-sm font-medium text-purple-700",children:["Mensagem ",C+1,C===0&&" (Imediata)"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:436,columnNumber:25},this),T.length>1&&e.jsxDEV("button",{type:"button",onClick:()=>K(m.id),className:"p-1 text-red-500 hover:bg-red-50 rounded",children:e.jsxDEV(Dt,{size:14},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:446,columnNumber:29},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:441,columnNumber:27},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:435,columnNumber:23},this),C>0&&e.jsxDEV("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs text-gray-600 mb-1",children:"Dias"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:454,columnNumber:29},this),e.jsxDEV("input",{type:"number",min:"0",value:m.delayDays,onChange:F=>V(m.id,"delayDays",parseInt(F.target.value)||0),className:"w-full p-2 border border-gray-300 rounded text-sm"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:455,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:453,columnNumber:27},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs text-gray-600 mb-1",children:"Horas"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:464,columnNumber:29},this),e.jsxDEV("input",{type:"number",min:"0",max:"23",value:m.delayHours,onChange:F=>V(m.id,"delayHours",parseInt(F.target.value)||0),className:"w-full p-2 border border-gray-300 rounded text-sm"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:465,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:463,columnNumber:27},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs text-gray-600 mb-1",children:"Minutos"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:475,columnNumber:29},this),e.jsxDEV("input",{type:"number",min:"0",max:"59",value:m.delayMinutes,onChange:F=>V(m.id,"delayMinutes",parseInt(F.target.value)||0),className:"w-full p-2 border border-gray-300 rounded text-sm"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:476,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:474,columnNumber:27},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:452,columnNumber:25},this),e.jsxDEV("textarea",{value:m.message,onChange:F=>V(m.id,"message",F.target.value),placeholder:`Digite a ${C+1}Âª mensagem da sequÃªncia...`,rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none text-sm"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:488,columnNumber:23},this)]},m.id,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:434,columnNumber:21},this))},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:432,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:416,columnNumber:15},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsxDEV(Fe,{size:16,className:"inline mr-1"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:504,columnNumber:17},this),"Prioridade"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:503,columnNumber:15},this),e.jsxDEV("select",{value:c,onChange:m=>p(m.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",children:[e.jsxDEV("option",{value:"low",children:"Baixa"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:512,columnNumber:17},this),e.jsxDEV("option",{value:"medium",children:"MÃ©dia"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:513,columnNumber:17},this),e.jsxDEV("option",{value:"high",children:"Alta"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:514,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:507,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:502,columnNumber:13},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsxDEV(re,{size:16,className:"inline mr-1"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:521,columnNumber:17},this),"ObservaÃ§Ãµes (opcional)"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:520,columnNumber:15},this),e.jsxDEV("textarea",{value:x,onChange:m=>D(m.target.value),placeholder:"Adicione observaÃ§Ãµes sobre este agendamento...",rows:2,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 resize-none"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:524,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:519,columnNumber:13},this),e.jsxDEV("div",{className:"flex gap-3 pt-4",children:[e.jsxDEV("button",{type:"button",onClick:t,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors",children:"Cancelar"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:535,columnNumber:15},this),e.jsxDEV("button",{type:"submit",disabled:!n||M,className:"flex-1 px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors",children:M?"Agendando...":S==="single"?"Agendar Envio":"Criar SequÃªncia"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:542,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:534,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:264,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:246,columnNumber:9},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:245,columnNumber:7},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/NewScheduleModal.tsx",lineNumber:244,columnNumber:5},this):null}function de({className:i,variant:t="default",size:o="default",children:s,...l}){const n="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",d={default:"bg-gray-900 text-gray-50 hover:bg-gray-900/90",destructive:"bg-red-500 text-gray-50 hover:bg-red-500/90",outline:"border border-gray-200 bg-white hover:bg-gray-100 hover:text-gray-900",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-100/80",ghost:"hover:bg-gray-100 hover:text-gray-900",link:"text-gray-900 underline-offset-4 hover:underline"},a={default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"};return e.jsxDEV("button",{className:U(n,d[t],a[o],i),...l,children:s},void 0,!1,{fileName:"C:/Chatvendas_new/src/components/ui/button.tsx",lineNumber:36,columnNumber:5},this)}function _t({checked:i,onCheckedChange:t,disabled:o=!1,className:s}){return e.jsxDEV("button",{type:"button",role:"switch","aria-checked":i,disabled:o,onClick:()=>t(!i),className:U("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50",i?"bg-gray-900":"bg-gray-200",s),children:e.jsxDEV("span",{className:U("pointer-events-none block h-5 w-5 rounded-full bg-white shadow-lg ring-0 transition-transform",i?"translate-x-5":"translate-x-0")},void 0,!1,{fileName:"C:/Chatvendas_new/src/components/ui/switch.tsx",lineNumber:25,columnNumber:7},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/components/ui/switch.tsx",lineNumber:13,columnNumber:5},this)}function Ft({children:i,variant:t="default",className:o}){const s={default:"border-transparent bg-gray-900 text-gray-50 hover:bg-gray-900/80",secondary:"border-transparent bg-gray-100 text-gray-900 hover:bg-gray-100/80",destructive:"border-transparent bg-red-500 text-gray-50 hover:bg-red-500/80",outline:"text-gray-950 border-gray-200"};return e.jsxDEV("div",{className:U("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2",s[t],o),children:i},void 0,!1,{fileName:"C:/Chatvendas_new/src/components/ui/badge.tsx",lineNumber:19,columnNumber:5},this)}class Ut{constructor(){B(this,"sequences",[]);B(this,"activeSales",new Map);this.setupDefaultSequences(),this.startSaleMonitoring()}setupDefaultSequences(){this.sequences=[{id:"post_delivery_complete",name:"PÃ³s-entrega Completa",trigger:"post_sale",steps:[{id:"satisfaction_check",delayDays:2,messageType:"satisfaction",priority:"medium"}],active:!0},{id:"future_purchase_nurturing",name:"NutriÃ§Ã£o para Compras Futuras",trigger:"future_purchase",steps:[{id:"gentle_reminder_1",delayDays:30,messageType:"future_nurturing",priority:"low"},{id:"product_recommendation",delayDays:60,messageType:"product_recommendation",priority:"low"},{id:"gentle_reminder_2",delayDays:120,messageType:"future_nurturing",priority:"low"}],active:!0}]}async onSaleCompleted(t){try{console.log("ðŸŽ‰ Venda detectada - Aguardando entrega para iniciar follow-up:",t),this.activeSales.set(t.contactId,t),console.log("â³ Aguardando status de entrega para iniciar follow-up automÃ¡tico")}catch(o){console.error("Erro ao processar venda:",o)}}async onOrderDelivered(t){try{console.log("ðŸ“¦ Entrega detectada - Iniciando follow-up pÃ³s-entrega:",t);const o=this.activeSales.get(t.contactId);if(!o){console.warn("Dados da venda nÃ£o encontrados para:",t.contactId);return}const l=(await H.getAll()).find(n=>n.id===t.contactId);if(!l){console.warn("Cliente nÃ£o encontrado:",t.contactId);return}await this.cancelPreviousSequences(t.contactId),await this.createPostDeliverySequence(l,o,t),await this.createFuturePurchaseSequence(l,o),console.log("âœ… SequÃªncias pÃ³s-entrega criadas para:",l.name)}catch(o){console.error("Erro ao processar entrega:",o)}}async createPostDeliverySequence(t,o,s){const l=this.sequences.find(d=>d.trigger==="post_sale"&&d.active);if(!l)return;console.log(`ðŸ“¦ Criando sequÃªncia pÃ³s-entrega para ${t.name} (2 dias apÃ³s entrega)`);const n=[];for(const d of l.steps){const a=await this.generatePostDeliveryMessage(t,o,s,d.messageType),N=new Date(s.deliveredAt),c=this.addDays(N,d.delayDays),p={id:this.generateId(),contactId:t.id,contactName:t.name,contactPhone:t.phoneNumber,contactAvatar:t.avatar||"",type:"sequence_auto",status:"scheduled",dueDate:c.toISOString(),priority:d.priority,sequenceId:`auto_post_delivery_${o.orderId}`,sequenceStep:l.steps.indexOf(d)+1,sequenceStepId:d.id,aiReason:`PÃ³s-entrega automÃ¡tica: ${this.getStepDescription(d.messageType)}`,suggestedMessage:a,ltv:t.ltv,context:{autoSend:!0,totalSteps:l.steps.length,saleData:o,deliveryData:s,messageType:d.messageType,isPostDelivery:!0}};n.push(p)}this.notifyTasksCreated(n)}async createFuturePurchaseSequence(t,o){const s=this.sequences.find(n=>n.trigger==="future_purchase"&&n.active);if(!s)return;console.log(`ðŸ”® Criando sequÃªncia para compras futuras - ${t.name}`);const l=[];for(const n of s.steps){const d=await this.generateFutureNurturingMessage(t,o,n.messageType),a=this.addDays(new Date,n.delayDays),N={id:this.generateId(),contactId:t.id,contactName:t.name,contactPhone:t.phoneNumber,contactAvatar:t.avatar||"",type:"sequence_auto",status:"scheduled",dueDate:a.toISOString(),priority:n.priority,sequenceId:`auto_future_${o.orderId}`,sequenceStep:s.steps.indexOf(n)+1,sequenceStepId:n.id,aiReason:`NutriÃ§Ã£o futura: ${this.getStepDescription(n.messageType)}`,suggestedMessage:d,ltv:t.ltv,context:{autoSend:!0,totalSteps:s.steps.length,saleData:o,messageType:n.messageType,isNurturing:!0}};l.push(N)}this.notifyTasksCreated(l)}async generatePostDeliveryMessage(t,o,s,l){const n=this.getFirstName(t.name);try{if(!O.isConfigured())return this.getDefaultPostDeliveryMessage(n,o,s,l);const d=this.buildAIContext(t,o,s),a=this.buildPostDeliveryPrompt(l,d);return(await O.generateSmartMessage("post_sale_satisfaction",d,a)).content}catch(d){return console.warn("Erro ao gerar mensagem pÃ³s-entrega com IA:",d),this.getDefaultPostDeliveryMessage(n,o,s,l)}}async generateFutureNurturingMessage(t,o,s){const l=this.getFirstName(t.name);try{if(!O.isConfigured())return this.getDefaultNurturingMessage(l,o,s);const n=this.buildAIContext(t,o),d=this.buildNurturingPrompt(s,n);return(await O.generateSmartMessage("lead_nurturing",n,d)).content}catch(n){return console.warn("Erro ao gerar mensagem de nutriÃ§Ã£o com IA:",n),this.getDefaultNurturingMessage(l,o,s)}}buildAIContext(t,o,s){return{contactName:t.name,contactPhone:t.phoneNumber,contactTags:t.tags||[],ltv:t.ltv,lastPurchaseDate:o.saleDate,lastPurchaseValue:o.value,lastPurchaseProducts:o.products,kanbanStage:t.kanbanStage,totalPurchases:t.totalPurchases||1,averageOrderValue:t.averageOrderValue||o.value,preferredProducts:t.preferredProducts||o.products,customFields:{orderId:o.orderId,isNewCustomer:!t.lastPurchaseDate,purchaseHistory:t.purchaseHistory||[],deliveredAt:s==null?void 0:s.deliveredAt,trackingCode:s==null?void 0:s.trackingCode,daysSinceDelivery:s?Math.floor((Date.now()-new Date(s.deliveredAt).getTime())/(1e3*60*60*24)):0}}}buildPostDeliveryPrompt(t,o){const s=this.getFirstName(o.contactName),l=o.lastPurchaseProducts.join(", "),n=o.customFields.daysSinceDelivery||2,d={satisfaction:`Gere uma mensagem CURTA pedindo feedback sobre o produto entregue.
Cliente: ${s}
Produtos entregues hÃ¡ ${n} dias: ${l}
Pedido: ${o.customFields.orderId}

INSTRUÃ‡Ã•ES:
- MÃ¡ximo 120 caracteres
- Pergunte sobre satisfaÃ§Ã£o com o produto recebido
- Seja gentil e nÃ£o insistente
- Use 1 emoji apenas
- Foque na experiÃªncia com o produto, nÃ£o na entrega
- NÃ£o mencione rastreamento (jÃ¡ foi tratado pelo mÃ³dulo pedidos)`};return d[t]||d.satisfaction}buildNurturingPrompt(t,o){const s=this.getFirstName(o.contactName),l=o.ltv>500,n=Math.floor((Date.now()-new Date(o.lastPurchaseDate).getTime())/(1e3*60*60*24)),d={future_nurturing:`Gere uma mensagem SUTIL de nutriÃ§Ã£o para compra futura.
Cliente: ${s}
${l?"Cliente VIP":"Cliente regular"}
Ãšltima compra hÃ¡ ${n} dias

INSTRUÃ‡Ã•ES:
- MÃ¡ximo 100 caracteres
- NÃƒO seja insistente ou vendedor
- OfereÃ§a valor (dica, novidade)
- Tom casual e amigÃ¡vel
- 1 emoji apenas
- NÃƒO mencione "comprar" diretamente`,product_recommendation:`Gere uma mensagem DISCRETA com recomendaÃ§Ã£o de produto.
Cliente: ${s}
HistÃ³rico: ${o.lastPurchaseProducts.join(", ")}

INSTRUÃ‡Ã•ES:
- MÃ¡ximo 130 caracteres
- Recomende produto relacionado
- Seja sutil, nÃ£o agressivo
- Foque no benefÃ­cio para o cliente
- Use "que tal" ou "vocÃª conhece"
- 1-2 emojis apenas`};return d[t]||d.future_nurturing}getDefaultPostDeliveryMessage(t,o,s,l){const n={satisfaction:`Oi ${t}! Como estÃ¡ seu produto? Ficou satisfeito com sua compra? Sua opiniÃ£o Ã© muito importante! â­`};return n[l]||n.satisfaction}getDefaultNurturingMessage(t,o,s){const l={future_nurturing:`Oi ${t}! Tudo bem? Temos algumas novidades que podem te interessar! ðŸ˜Š`,product_recommendation:`${t}, que tal conhecer nossos lanÃ§amentos? Temos produtos incrÃ­veis para vocÃª! âœ¨`};return l[s]||l.future_nurturing}async cancelPreviousSequences(t){window.dispatchEvent(new CustomEvent("cancel_auto_sequences",{detail:{contactId:t}}))}notifyTasksCreated(t){window.dispatchEvent(new CustomEvent("auto_tasks_created",{detail:{tasks:t}}))}getStepDescription(t){return{confirmation:"ConfirmaÃ§Ã£o do pedido",satisfaction:"Pesquisa de satisfaÃ§Ã£o",future_nurturing:"NutriÃ§Ã£o sutil",product_recommendation:"RecomendaÃ§Ã£o de produto"}[t]||t}getFirstName(t){return t.split(" ")[0]}addDays(t,o){const s=new Date(t);return s.setDate(s.getDate()+o),s}generateId(){return`auto_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}startSaleMonitoring(){window.addEventListener("sale_completed",t=>{this.onSaleCompleted(t.detail)}),window.addEventListener("order_delivered",t=>{this.onOrderDelivered(t.detail)}),window.addEventListener("order_status_changed",t=>{t.detail.newStatus==="delivered"&&this.onOrderDelivered({contactId:t.detail.contactId,orderId:t.detail.orderId,deliveredAt:t.detail.deliveredAt||new Date().toISOString(),trackingCode:t.detail.trackingCode})}),window.addEventListener("ticket_status_changed",t=>{t.detail.newStatus==="closed"&&t.detail.saleData&&this.onSaleCompleted(t.detail.saleData)}),console.log("ðŸ‘‚ Monitoramento de vendas e entregas iniciado")}triggerSale(t,o,s,l){const n={contactId:t,orderId:o,value:s,products:l,saleDate:new Date().toISOString()};this.onSaleCompleted(n)}triggerDelivery(t,o,s){const l={contactId:t,orderId:o,deliveredAt:new Date().toISOString(),trackingCode:s};this.onOrderDelivered(l)}updateSequence(t,o){const s=this.sequences.findIndex(l=>l.id===t);s!==-1&&(this.sequences[s]={...this.sequences[s],...o})}getStats(){var s,l;const t=this.activeSales.size,o=this.sequences.filter(n=>n.active).length;return{activeSales:t,totalSequences:o,postSaleActive:((s=this.sequences.find(n=>n.id==="post_sale_complete"))==null?void 0:s.active)||!1,futureNurturingActive:((l=this.sequences.find(n=>n.id==="future_purchase_nurturing"))==null?void 0:l.active)||!1}}toggleSequence(t,o){const s=this.sequences.find(l=>l.id===t);s&&(s.active=o,console.log(`${o?"â–¶ï¸":"â¸ï¸"} SequÃªncia ${s.name} ${o?"ativada":"pausada"}`))}}const L=new Ut;typeof window<"u"&&(window.AutoFollowUpService=L,console.log("ðŸ¤– Sistema automÃ¡tico de follow-up inicializado"),console.log('ðŸ’¡ Para testar: AutoFollowUpService.triggerSale("contact_123", "order_123", 299.90, ["Produto Teste"])'));function Ve(){const[i,t]=W.useState({activeSales:0,totalSequences:2,postSaleActive:!0,futureNurturingActive:!0});W.useEffect(()=>{try{const c=L.getStats();t(c)}catch(c){console.warn("Erro ao carregar estatÃ­sticas:",c)}const a=c=>{const{tasks:p}=c.detail;console.log(`âœ… ${p.length} tarefas automÃ¡ticas criadas`),window.dispatchEvent(new CustomEvent("followup-update"))},N=c=>{const{contactId:p}=c.detail;console.log(`ðŸš« Cancelando sequÃªncias para ${p}`),window.dispatchEvent(new CustomEvent("followup-update"))};return window.addEventListener("auto_tasks_created",a),window.addEventListener("cancel_auto_sequences",N),()=>{window.removeEventListener("auto_tasks_created",a),window.removeEventListener("cancel_auto_sequences",N)}},[]);const[o,s]=W.useState(!1),[l,n]=W.useState([]),d=()=>{try{const a=L.getSequences();n(a)}catch(a){console.warn("Erro ao carregar sequÃªncias:",a)}};return W.useEffect(()=>{d()},[]),{stats:i,sequences:l,isLoading:o,refreshSequences:d,triggerSale:async(a,N,c,p)=>{s(!0);try{await L.triggerSale(a,N,c,p);const x=L.getStats();t(x)}catch(x){console.error("Erro ao disparar venda:",x)}finally{s(!1)}},getStats:()=>{try{const a=L.getStats();return t(a),a}catch(a){return console.warn("Erro ao obter estatÃ­sticas:",a),i}},toggleSequence:async(a,N)=>{s(!0);try{await L.toggleSequence(a,N);const c=L.getStats();t(c),d()}catch(c){console.error("Erro ao alterar sequÃªncia:",c)}finally{s(!1)}},updateSequence:async(a,N)=>{s(!0);try{await L.updateSequence(a,N),d()}catch(c){console.error("Erro ao atualizar sequÃªncia:",c)}finally{s(!1)}}}}function jt({isOpen:i,onClose:t}){const{sequences:o,toggleSequence:s,updateSequence:l}=Ve(),[n,d]=W.useState(null),[a,N]=W.useState(null),c=b=>{d(b.id),N(JSON.parse(JSON.stringify(b)))},p=()=>{n&&a&&(l(n,a),d(null),N(null))},x=(b,_,f)=>{const S=[...a.steps];S[b]={...S[b],[_]:f},N({...a,steps:S})},D=()=>{const b={id:`step_${Date.now()}`,delayDays:1,messageType:"future_nurturing",priority:"low"};N({...a,steps:[...a.steps,b]})},M=b=>{const _=a.steps.filter((f,S)=>S!==b);N({...a,steps:_})};return i?e.jsxDEV("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxDEV("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden animate-in zoom-in-95 duration-200 flex flex-col max-h-[85vh]",children:[e.jsxDEV("div",{className:"bg-white border-b border-gray-100 px-6 py-4 flex justify-between items-center shrink-0",children:[e.jsxDEV("div",{className:"flex items-center gap-3",children:[e.jsxDEV("div",{className:"p-2 bg-blue-50 text-blue-600 rounded-lg",children:e.jsxDEV(le,{size:20},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:72,columnNumber:29},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:71,columnNumber:25},this),e.jsxDEV("div",{children:[e.jsxDEV("h2",{className:"text-lg font-bold text-gray-800 leading-tight",children:"AutomaÃ§Ã£o"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:75,columnNumber:29},this),e.jsxDEV("p",{className:"text-xs text-gray-500",children:"Gerencie suas sequÃªncias automÃ¡ticas"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:76,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:74,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:70,columnNumber:21},this),e.jsxDEV("button",{onClick:t,className:"hover:bg-gray-100 p-2 rounded-full transition-colors text-gray-400 hover:text-gray-600",children:e.jsxDEV(Ye,{size:20},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:80,columnNumber:25},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:79,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:69,columnNumber:17},this),e.jsxDEV("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:[n?e.jsxDEV("div",{className:"space-y-6 animate-in slide-in-from-right-4 duration-200",children:[e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("button",{onClick:()=>d(null),className:"text-sm font-bold text-gray-500 hover:text-gray-700 flex items-center gap-1",children:[e.jsxDEV(ve,{size:16,className:"rotate-180"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:151,columnNumber:37},this)," Voltar"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:147,columnNumber:33},this),e.jsxDEV("h3",{className:"font-bold text-gray-800",children:["Editando: ",a.name]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:153,columnNumber:33},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:146,columnNumber:29},this),e.jsxDEV("div",{className:"space-y-4",children:[a.steps.map((b,_)=>e.jsxDEV("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm space-y-3",children:[e.jsxDEV("div",{className:"flex justify-between items-center",children:[e.jsxDEV("span",{className:"text-xs font-bold text-blue-600 uppercase tracking-wider",children:["Mensagem ",_+1]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:160,columnNumber:45},this),e.jsxDEV("button",{onClick:()=>M(_),className:"text-gray-400 hover:text-red-500 p-1",children:e.jsxDEV(Ke,{size:16},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:165,columnNumber:49},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:161,columnNumber:45},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:159,columnNumber:41},this),e.jsxDEV("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-[10px] font-bold text-gray-400 uppercase mb-1",children:"Atraso (Dias)"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:171,columnNumber:49},this),e.jsxDEV("input",{type:"number",className:"w-full p-2 border rounded-lg text-sm bg-gray-50 outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",value:b.delayDays,onChange:f=>x(_,"delayDays",parseInt(f.target.value)||0)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:172,columnNumber:49},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:170,columnNumber:45},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-[10px] font-bold text-gray-400 uppercase mb-1",children:"EstratÃ©gia"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:180,columnNumber:49},this),e.jsxDEV("select",{className:"w-full p-2 border rounded-lg text-sm bg-gray-50 outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",value:b.messageType,onChange:f=>x(_,"messageType",f.target.value),children:[e.jsxDEV("option",{value:"confirmation",children:"ðŸš€ ConfirmaÃ§Ã£o"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:186,columnNumber:53},this),e.jsxDEV("option",{value:"satisfaction",children:"â­ SatisfaÃ§Ã£o"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:187,columnNumber:53},this),e.jsxDEV("option",{value:"future_nurturing",children:"ðŸ’¡ NutriÃ§Ã£o"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:188,columnNumber:53},this),e.jsxDEV("option",{value:"product_recommendation",children:"ðŸ›ï¸ RecomendaÃ§Ã£o"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:189,columnNumber:53},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:181,columnNumber:49},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:179,columnNumber:45},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:169,columnNumber:41},this),e.jsxDEV("div",{className:"bg-blue-50/50 p-2.5 rounded-lg border border-blue-100/50",children:[e.jsxDEV("p",{className:"text-[10px] font-bold text-blue-600 uppercase mb-1 flex items-center gap-1",children:[e.jsxDEV(le,{size:10},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:196,columnNumber:49},this)," O que a IA escreverÃ¡:"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:195,columnNumber:45},this),e.jsxDEV("p",{className:"text-xs text-blue-800 italic leading-relaxed",children:[b.messageType==="confirmation"&&"Uma mensagem calorosa confirmando o pedido, agradecendo a confianÃ§a e mencionando o processamento do envio.",b.messageType==="satisfaction"&&"Um contato amigÃ¡vel perguntando se o cliente gostou do produto e pedindo um feedback sincero.",b.messageType==="future_nurturing"&&"Um toque sutil para manter a marca na mente do cliente, com uma dica ou novidade sem ser invasivo.",b.messageType==="product_recommendation"&&"Uma sugestÃ£o personalizada baseada nos produtos que o cliente jÃ¡ comprou anteriormente."]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:198,columnNumber:45},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:194,columnNumber:41},this)]},_,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:158,columnNumber:37},this)),e.jsxDEV(de,{variant:"outline",onClick:D,className:"w-full border-dashed border-gray-300 py-6 text-gray-500 hover:text-blue-600 hover:border-blue-300",children:[e.jsxDEV(Me,{size:18,className:"mr-2"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:213,columnNumber:37},this)," Adicionar Mensagem"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:208,columnNumber:33},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:156,columnNumber:29},this),e.jsxDEV("div",{className:"bg-amber-50 border border-amber-100 rounded-lg p-3 text-amber-800 text-[11px] leading-relaxed",children:[e.jsxDEV("strong",{children:"ðŸ’¡ Por que nÃ£o vejo o texto fixo?"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:218,columnNumber:33},this)," As mensagens sÃ£o geradas dinamicamente pela IA no momento do envio. Ela usa o nome do cliente, o produto comprado e o valor total para criar uma mensagem Ãºnica e 100% humana para cada pessoa."]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:217,columnNumber:29},this),e.jsxDEV("div",{className:"pt-4 flex gap-3",children:[e.jsxDEV(de,{variant:"outline",className:"flex-1",onClick:()=>d(null),children:"Cancelar"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:222,columnNumber:33},this),e.jsxDEV(de,{className:"flex-1 bg-blue-600 hover:bg-blue-700",onClick:p,children:[e.jsxDEV(et,{size:18,className:"mr-2"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:233,columnNumber:37},this)," Salvar AlteraÃ§Ãµes"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:229,columnNumber:33},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:221,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:145,columnNumber:25},this):e.jsxDEV("div",{className:"space-y-4",children:o.map(b=>{const _=b.steps.reduce((f,S)=>Math.max(f,S.delayDays),0);return e.jsxDEV("div",{className:U("flex items-center justify-between p-4 border rounded-xl bg-white shadow-sm transition-all hover:shadow-md group",b.active?"border-blue-100 ring-1 ring-blue-50":"border-gray-200 opacity-80"),children:[e.jsxDEV("div",{className:"flex-1 cursor-pointer",onClick:()=>c(b),children:[e.jsxDEV("div",{className:"flex items-center gap-3 mb-1.5",children:[e.jsxDEV("h4",{className:"font-bold text-gray-800",children:b.name},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:100,columnNumber:49},this),e.jsxDEV(Ft,{variant:b.active?"default":"secondary",className:U("text-[10px] uppercase tracking-wider font-bold h-5",b.active?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-500"),children:b.active?"Ativo":"Pausado"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:101,columnNumber:49},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:99,columnNumber:45},this),e.jsxDEV("p",{className:"text-sm text-gray-500 mb-3 font-medium",children:b.id==="post_sale_complete"?"ConfirmaÃ§Ã£o e Pesquisa de SatisfaÃ§Ã£o":"NutriÃ§Ã£o e RecomendaÃ§Ã£o AutomÃ¡tica"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:111,columnNumber:45},this),e.jsxDEV("div",{className:"flex items-center gap-4 text-xs font-semibold text-gray-400 group-hover:text-blue-500 transition-colors",children:[e.jsxDEV("span",{className:"flex items-center gap-1.5 bg-gray-50 px-2 py-1 rounded border border-gray-100",children:[e.jsxDEV(oe,{size:12},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:117,columnNumber:53},this),b.steps.length," mensagens"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:116,columnNumber:49},this),e.jsxDEV("span",{className:"flex items-center gap-1.5 bg-gray-50 px-2 py-1 rounded border border-gray-100",children:[e.jsxDEV(je,{size:12},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:121,columnNumber:53},this),_," dias (mÃ¡ximo)"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:120,columnNumber:49},this),e.jsxDEV("span",{className:"ml-auto flex items-center gap-1 text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity",children:["Editar ",e.jsxDEV(ve,{size:14},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:125,columnNumber:60},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:124,columnNumber:49},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:115,columnNumber:45},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:98,columnNumber:41},this),e.jsxDEV("div",{className:"pl-6 border-l border-gray-100 ml-6 flex flex-col items-center gap-2",children:[e.jsxDEV(_t,{checked:b.active,onCheckedChange:f=>s(b.id,f),className:"data-[state=checked]:bg-blue-600"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:131,columnNumber:45},this),e.jsxDEV("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:b.active?"ON":"OFF"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:136,columnNumber:45},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:130,columnNumber:41},this)]},b.id,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:91,columnNumber:37},this)})},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:87,columnNumber:25},this),!n&&e.jsxDEV("div",{className:"bg-blue-50 border border-blue-100 rounded-xl p-4 flex gap-3 text-blue-700 text-sm mt-6",children:[e.jsxDEV(le,{size:20,className:"shrink-0 mt-0.5"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:241,columnNumber:29},this),e.jsxDEV("div",{children:[e.jsxDEV("p",{className:"font-bold mb-1",children:"Modo AutomÃ¡tico"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:243,columnNumber:33},this),e.jsxDEV("p",{className:"text-blue-600/80 leading-relaxed text-xs",children:"O sistema monitora vendas e carrinhos para disparar estas sequÃªncias automaticamente respeitando os horÃ¡rios comerciais e regras anti-spam."},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:244,columnNumber:33},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:242,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:240,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:85,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:66,columnNumber:13},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/components/FollowUpSettingsModal.tsx",lineNumber:65,columnNumber:9},this):null}function Ht(){const i=Je(),[t,o]=r.useState([]),[s,l]=r.useState(null),[n,d]=r.useState("list"),[a,N]=r.useState(!1),[c,p]=r.useState(!1),[x,D]=r.useState(!1),[M,b]=r.useState(!1),[_,f]=r.useState(!1),[S,A]=r.useState(null);Ve();const j=()=>{try{o($.getAll()),l($.getStats())}catch(E){console.error("Erro ao carregar dados do follow-up:",E),o([]),l({pending:0,scheduled:0,completedToday:0,highPriority:0,recoveryPotential:0,activeSequences:0})}};r.useEffect(()=>(N(!0),j(),N(!1),window.addEventListener("followup-update",j),()=>window.removeEventListener("followup-update",j)),[]);const P=(E,I)=>{I==="complete"?($.completeTask(E.id),j()):I==="snooze"?($.snoozeTask(E.id,1),j()):I==="chat"?i(`/atendimentos?contact=${E.contactId}`):I==="quick_send"&&(A(E),D(!0))},Q=async()=>{p(!0);try{await $.generateAiTasks(),j(),n!=="suggestions"&&d("suggestions")}finally{p(!1)}},R=r.useMemo(()=>t.filter(E=>["ai_recovery","kanban_stuck","cold_lead","vip_attention","post_sale"].includes(E.type)&&E.status==="pending").length,[t]);return e.jsxDEV("div",{className:"h-full flex flex-col bg-gray-50 overflow-hidden",children:[e.jsxDEV("div",{className:"bg-white border-b border-gray-200 px-8 py-5 shrink-0",children:[e.jsxDEV("div",{className:"flex justify-between items-center mb-6",children:[e.jsxDEV("div",{children:[e.jsxDEV("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsxDEV(we,{className:"text-emerald-600"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:113,columnNumber:15},this),"Follow-up"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:112,columnNumber:13},this),e.jsxDEV("p",{className:"text-gray-500 mt-1 text-sm",children:"Gerencie seus retornos e nÃ£o perca vendas."},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:116,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:111,columnNumber:11},this),e.jsxDEV("div",{className:"flex gap-2",children:[e.jsxDEV("button",{onClick:()=>f(!0),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition",title:"ConfiguraÃ§Ãµes de AutomaÃ§Ã£o",children:e.jsxDEV(Ge,{size:20},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:124,columnNumber:15},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:119,columnNumber:13},this),e.jsxDEV("button",{onClick:Q,disabled:c,className:U("bg-purple-50 text-purple-700 border border-purple-200 px-3 py-2 rounded-lg flex items-center gap-2 hover:bg-purple-100 transition text-sm font-medium",c&&"opacity-50 cursor-not-allowed"),title:"Buscar oportunidades com IA",children:[e.jsxDEV(Y,{size:16,className:c?"animate-spin":""},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:135,columnNumber:15},this),c?"Analisando...":"Buscar Oportunidades"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:126,columnNumber:13},this),e.jsxDEV("button",{onClick:()=>b(!0),className:"bg-emerald-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-emerald-700 transition shadow-sm font-bold text-sm",children:[e.jsxDEV(Me,{size:18},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:142,columnNumber:15},this),"Novo Agendamento"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:138,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:118,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:110,columnNumber:9},this),e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("div",{className:"flex gap-1 bg-gray-100 p-1 rounded-lg w-fit",children:[e.jsxDEV("button",{onClick:()=>d("suggestions"),className:U("px-4 py-2 rounded-md text-sm font-medium flex items-center gap-2 transition-all relative",n==="suggestions"?"bg-white text-purple-700 shadow-sm":"text-gray-500 hover:text-gray-700"),children:[e.jsxDEV(Y,{size:16},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:158,columnNumber:15},this),"SugestÃµes",R>0&&e.jsxDEV("span",{className:"ml-1 bg-purple-100 text-purple-700 text-xs px-1.5 rounded-full font-bold",children:R},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:161,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:151,columnNumber:13},this),e.jsxDEV("button",{onClick:()=>d("list"),className:U("px-4 py-2 rounded-md text-sm font-medium flex items-center gap-2 transition-all relative",n==="list"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"),children:[e.jsxDEV(at,{size:16},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:173,columnNumber:15},this),"Minhas Tarefas",s&&s.pending>0&&e.jsxDEV("span",{className:"ml-1 bg-gray-200 text-gray-700 text-xs px-1.5 rounded-full font-bold",children:s.pending},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:176,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:166,columnNumber:13},this),e.jsxDEV("button",{onClick:()=>d("calendar"),className:U("px-4 py-2 rounded-md text-sm font-medium flex items-center gap-2 transition-all",n==="calendar"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"),children:[e.jsxDEV(we,{size:16},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:188,columnNumber:15},this),"CalendÃ¡rio"]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:181,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:150,columnNumber:11},this),s&&e.jsxDEV("div",{className:"flex gap-6 text-sm",children:[e.jsxDEV("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsxDEV("div",{className:"w-2 h-2 rounded-full bg-orange-400"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:197,columnNumber:17},this),e.jsxDEV("span",{children:["Pendentes: ",e.jsxDEV("span",{className:"font-bold text-gray-900",children:s.pending},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:198,columnNumber:34},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:198,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:196,columnNumber:15},this),e.jsxDEV("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsxDEV("div",{className:"w-2 h-2 rounded-full bg-red-500"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:201,columnNumber:17},this),e.jsxDEV("span",{children:["Prioridade: ",e.jsxDEV("span",{className:"font-bold text-gray-900",children:s.highPriority},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:202,columnNumber:35},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:202,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:200,columnNumber:15},this),e.jsxDEV("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsxDEV("div",{className:"w-2 h-2 rounded-full bg-green-500"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:205,columnNumber:17},this),e.jsxDEV("span",{children:["Feitos Hoje: ",e.jsxDEV("span",{className:"font-bold text-gray-900",children:s.completedToday},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:206,columnNumber:36},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:206,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:204,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:195,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:148,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:109,columnNumber:7},this),e.jsxDEV("div",{className:"flex-1 overflow-y-auto px-8 py-6",children:a?e.jsxDEV("div",{className:"flex items-center justify-center h-64",children:e.jsxDEV("div",{className:"flex flex-col items-center gap-3",children:[e.jsxDEV(tt,{size:32,className:"animate-spin text-gray-400"},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:218,columnNumber:15},this),e.jsxDEV("p",{className:"text-gray-500",children:"Carregando..."},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:219,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:217,columnNumber:13},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:216,columnNumber:11},this):e.jsxDEV("div",{className:"max-w-7xl mx-auto",children:[n==="suggestions"&&e.jsxDEV(it,{tasks:t,onAction:P},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:224,columnNumber:44},this),n==="list"&&e.jsxDEV(ht,{tasks:t,onAction:P},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:225,columnNumber:37},this),n==="calendar"&&e.jsxDEV(mt,{tasks:t},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:226,columnNumber:41},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:223,columnNumber:11},this)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:214,columnNumber:7},this),x&&S&&e.jsxDEV(Ct,{isOpen:x,onClose:()=>{D(!1),A(null),j()},contactId:S.contactId,contactName:S.contactName,contactPhone:S.contactPhone,suggestedMessage:S.suggestedMessage,taskId:S.id},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:233,columnNumber:9},this),e.jsxDEV(Et,{isOpen:M,onClose:()=>b(!1),onSuccess:()=>{j()}},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:249,columnNumber:7},this),e.jsxDEV(jt,{isOpen:_,onClose:()=>f(!1)},void 0,!1,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:258,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Chatvendas_new/src/modules/FollowUp/page.tsx",lineNumber:107,columnNumber:5},this)}export{Ht as default};
