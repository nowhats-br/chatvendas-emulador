var l=Object.defineProperty;var a=(i,e,t)=>e in i?l(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var r=(i,e,t)=>a(i,typeof e!="symbol"?e+"":e,t);class g{constructor(){r(this,"logs",[]);r(this,"maxLogs",1e3);r(this,"sessionId");r(this,"logLevel","info");r(this,"listeners",[]);if(this.sessionId=this.generateSessionId(),typeof window<"u"){const t=new URLSearchParams(window.location.search).get("debug")==="true"||localStorage.getItem("debug")==="true";this.logLevel=t?"debug":"info"}}debug(e,t,s){this.log("debug",e,t,s)}info(e,t,s){this.log("info",e,t,s)}warn(e,t,s){this.log("warn",e,t,s)}error(e,t,s){this.log("error",e,t,s)}log(e,t,s,o){if(!this.shouldLog(e))return;const n={id:this.generateId(),timestamp:Date.now(),level:e,message:t,context:s,data:o,sessionId:this.sessionId,userAgent:typeof navigator<"u"?navigator.userAgent:void 0,url:typeof window<"u"?window.location.href:void 0};this.addEntry(n),this.notifyListeners(n),this.consoleLog(n)}addEntry(e){this.logs.unshift(e),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(0,this.maxLogs))}consoleLog(e){const t=`[${new Date(e.timestamp).toISOString()}] ${e.level.toUpperCase()}`,s=e.context?` [${e.context}]`:"",o=`${t}${s}: ${e.message}`;switch(e.level){case"debug":console.debug(o,e.data);break;case"info":console.info(o,e.data);break;case"warn":console.warn(o,e.data);break;case"error":console.error(o,e.data);break}}getLogs(e){let t=[...this.logs];if(e&&(e.level&&e.level.length>0&&(t=t.filter(s=>e.level.includes(s.level))),e.context&&e.context.length>0&&(t=t.filter(s=>s.context&&e.context.includes(s.context))),e.startDate&&(t=t.filter(s=>s.timestamp>=e.startDate)),e.endDate&&(t=t.filter(s=>s.timestamp<=e.endDate)),e.search)){const s=e.search.toLowerCase();t=t.filter(o=>o.message.toLowerCase().includes(s)||o.context&&o.context.toLowerCase().includes(s))}return t}getLogsByContext(e){return this.logs.filter(t=>t.context===e)}getLogsByLevel(e){return this.logs.filter(t=>t.level===e)}getRecentLogs(e=5){const t=Date.now()-e*60*1e3;return this.logs.filter(s=>s.timestamp>=t)}clearLogs(){this.logs=[],console.clear()}exportLogs(e){const t=this.getLogs(e);return JSON.stringify(t,null,2)}downloadLogs(e){const t=this.exportLogs(e),s=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(s),n=document.createElement("a");n.href=o,n.download=`chatvendas-logs-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)}setLogLevel(e){this.logLevel=e,this.info("Log level changed","LogService",{newLevel:e})}getLogLevel(){return this.logLevel}subscribe(e){return this.listeners.push(e),()=>{const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}}getStats(){const e={debug:0,info:0,warn:0,error:0},t={};return this.logs.forEach(s=>{e[s.level]++,s.context&&(t[s.context]=(t[s.context]||0)+1)}),{total:this.logs.length,byLevel:e,byContext:t,sessionId:this.sessionId,oldestLog:this.logs.length>0?Math.min(...this.logs.map(s=>s.timestamp)):null,newestLog:this.logs.length>0?Math.max(...this.logs.map(s=>s.timestamp)):null}}shouldLog(e){const t=["debug","info","warn","error"],s=t.indexOf(this.logLevel);return t.indexOf(e)>=s}notifyListeners(e){this.listeners.forEach(t=>{try{t(e)}catch(s){console.error("Error in log listener:",s)}})}generateId(){return Math.random().toString(36).substr(2,9)}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}const d=new g;export{d as L};
