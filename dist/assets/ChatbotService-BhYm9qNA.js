var p=Object.defineProperty;var g=(r,e,t)=>e in r?p(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var u=(r,e,t)=>g(r,typeof e!="symbol"?e+"":e,t);import{A as d}from"./AIConfigService-2_9wLCgs.js";class m{constructor(){u(this,"flows",[]);const e=localStorage.getItem("chatvendas_flows");e?this.flows=JSON.parse(e):(this.flows=[{id:"flow_1",name:"Atendimento Principal",description:"Fluxo de triagem inicial para novos clientes.",nodes:[{id:"start_1",type:"startNode",position:{x:100,y:100},data:{label:"Início"}},{id:"msg_1",type:"messageNode",position:{x:300,y:100},data:{label:"Boas Vindas",content:"Olá! Bem-vindo ao nosso atendimento."}}],edges:[{id:"e1",source:"start_1",target:"msg_1",animated:!0,style:{stroke:"#10b981"}}],isActive:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),triggerKeywords:["oi","olá","bom dia"]}],this.save())}save(){localStorage.setItem("chatvendas_flows",JSON.stringify(this.flows))}getAll(){return[...this.flows]}getById(e){return this.flows.find(t=>t.id===e)}create(e){const t={id:`flow_${Date.now()}`,...e,nodes:[{id:"start_1",type:"startNode",position:{x:250,y:250},data:{label:"Início"}}],edges:[],isActive:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),triggerKeywords:[]};return this.flows.push(t),this.save(),t}update(e,t){const i=this.flows.findIndex(o=>o.id===e);i!==-1&&(this.flows[i]={...this.flows[i],...t,updatedAt:new Date().toISOString()},this.save())}delete(e){this.flows=this.flows.filter(t=>t.id!==e),this.save()}async generateFlowFromPrompt(e){if(!d.isConfigured())throw new Error("IA não configurada. Configure uma API key nas configurações primeiro.");try{const t=`Crie um fluxo de chatbot baseado na seguinte descrição: "${e}"

Retorne uma estrutura JSON com:
- name: Nome do fluxo
- description: Descrição do fluxo
- nodes: Array de nós com id, type, position, data
- edges: Array de conexões entre nós

Tipos de nós disponíveis:
- startNode: Nó inicial
- messageNode: Mensagem de texto
- buttonsNode: Botões interativos
- listNode: Lista de opções
- aiNode: Resposta com IA
- delayNode: Pausa/delay

Crie um fluxo funcional e lógico baseado na descrição fornecida.`,i=await d.generateText(t);let o;try{o=JSON.parse(i)}catch{o=this.createBasicFlowFromPrompt(e)}const s=this.create({name:o.name||`Bot IA: ${e.substring(0,20)}...`,description:o.description||`Gerado via IA: ${e}`}),a=o.nodes||this.generateBasicNodes(e),n=o.edges||this.generateBasicEdges();return this.update(s.id,{nodes:a,edges:n}),{...s,nodes:a,edges:n}}catch(t){return console.error("Erro ao gerar fluxo com IA:",t),new Promise(i=>{setTimeout(()=>{const o=this.create({name:`Bot: ${e.substring(0,20)}...`,description:`Baseado em: ${e}`}),s=this.generateBasicNodes(e),a=this.generateBasicEdges();this.update(o.id,{nodes:s,edges:a}),i({...o,nodes:s,edges:a})},1e3)})}}createBasicFlowFromPrompt(e){return{name:`Bot IA: ${e.substring(0,20)}...`,description:`Gerado via IA: ${e}`,nodes:this.generateBasicNodes(e),edges:this.generateBasicEdges()}}generateBasicNodes(e){var a,n,c,l;const t=/loja|produto|compra|venda|pedido|carrinho/i.test(e),i=/suporte|ajuda|problema|dúvida|atendimento/i.test(e),o=/pizza|pizzaria|cardápio|entrega/i.test(e);let s=[{id:"start",type:"startNode",position:{x:100,y:50},data:{label:"Início"}},{id:"welcome",type:"messageNode",position:{x:300,y:50},data:{label:"Boas-vindas",content:"Olá! Como posso ajudar você hoje?"}}];return o?s.push({id:"menu",type:"buttonsNode",position:{x:500,y:50},data:{label:"Menu Principal",content:"Escolha uma opção:",buttons:[{id:"cardapio",text:"Ver Cardápio"},{id:"pedido",text:"Fazer Pedido"},{id:"status",text:"Status do Pedido"}]}},{id:"ai_cardapio",type:"aiNode",position:{x:700,y:0},data:{label:"IA - Cardápio",provider:((a=d.getConfig())==null?void 0:a.provider)||"openai",prompt:"Mostre o cardápio da pizzaria com preços e descrições das pizzas disponíveis."}}):t?s.push({id:"menu",type:"buttonsNode",position:{x:500,y:50},data:{label:"Menu Loja",content:"O que você procura?",buttons:[{id:"produtos",text:"Ver Produtos"},{id:"pedidos",text:"Meus Pedidos"},{id:"suporte",text:"Suporte"}]}},{id:"ai_produtos",type:"aiNode",position:{x:700,y:0},data:{label:"IA - Produtos",provider:((n=d.getConfig())==null?void 0:n.provider)||"openai",prompt:"Ajude o cliente a encontrar produtos baseado no que ele está procurando. Seja útil e sugira opções relevantes."}}):i?s.push({id:"ai_support",type:"aiNode",position:{x:500,y:50},data:{label:"IA - Suporte",provider:((c=d.getConfig())==null?void 0:c.provider)||"openai",prompt:"Você é um assistente de suporte. Ajude o cliente com suas dúvidas de forma clara e objetiva."}}):s.push({id:"ai_general",type:"aiNode",position:{x:500,y:50},data:{label:"IA - Assistente",provider:((l=d.getConfig())==null?void 0:l.provider)||"openai",prompt:`Você é um assistente virtual. Contexto: ${e}. Ajude o usuário de forma útil e amigável.`}}),s}generateBasicEdges(){return[{id:"e1",source:"start",target:"welcome",animated:!0,style:{stroke:"#10b981"}},{id:"e2",source:"welcome",target:"menu",animated:!0,style:{stroke:"#10b981"}}]}}const w=new m;export{w as C};
