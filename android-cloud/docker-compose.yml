services:
  # API de Gerenciamento
  android-api:
    build: ./api
    ports:
      - "3011:3011"
    environment:
      NODE_ENV: production
      PORT: 3011
      DOMAIN: ${DOMAIN:-localhost}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    restart: unless-stopped
    networks:
      - android-network

  # Android Emulator 1 (Exemplo)
  android-1:
    image: budtmo/docker-android:emulator_13.0
    privileged: true
    ports:
      - "5900:5900"   # VNC
      - "6080:6080"   # noVNC WebSocket
      - "5555:5555"   # ADB
    environment:
      # Dispositivo
      EMULATOR_DEVICE: "Samsung Galaxy S10"
      
      # Resolução (formato celular)
      EMULATOR_WIDTH: "720"
      EMULATOR_HEIGHT: "1520"
      
      # VNC
      WEB_VNC: "true"
      VNC_PASSWORD: "chatvendas123"
      
      # Performance
      EMULATOR_ARGS: "-gpu swiftshader_indirect -no-snapshot -noaudio -memory 4096"
      
      # Timezone
      TZ: "America/Sao_Paulo"
    volumes:
      - android-1-data:/data
    restart: unless-stopped
    networks:
      - android-network
    healthcheck:
      test: ["CMD", "adb", "devices"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  android-1-data:

networks:
  android-network:
    driver: bridge
